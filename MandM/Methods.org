#+TITLE:       Materials and Methods for the JFRE Atlantis model
#+AUTHOR:      Javier Porobic
#+EMAIL:       jporobicg@gmail.com
#+DESCRIPTION: This document Contain all the steps that I took to build the Atlantis Model for the Juan Fernandez Ridge Ecosystem
#+KEYWORDS:    Juan Fernandez Ridge ecosystem, Atlantis, Ecosystem-based fisheries management
#+LANGUAGE:    en
#+OPTIONS:     H:4
#+OPTIONS:     num:nil
#+OPTIONS:     toc:4
#+OPTIONS:     p:t
#+TOC:         headlines 4
* Installation of Atlantis
** The basic program an libraries to run Atlantis
*** Check if is installed
dpkg -l | grep build-essential   # Esscential packages to build debian
dpkg -l | grep autoconf          # Automatic configure script builder
dpkg -l | grep subversion        # Version Control System (like GITHUB)
dpkg -l | grep gawk              # GNU version de Awk
dpkg -l | grep proj              # Program Proj.4 Cartographic projection
dpkg -l | grep libxml2-dev       # Library for XML lenguaje
dpkg -l | grep libnetcdf-dev     # Library of development kit for NetCDF
dpkg -l | grep flip              # convert text file line endings between Unix and DOS

*** Install and installation check of libraries [7/7]
- [X] sudo apt-get install build-essential
- [X] sudo apt-get install autoconf
- [X] sudo apt-get install subversion
- [X] sudo apt-get install libxml2-dev
- [X] sudo apt-get install libnetcdf-dev
- [X] sudo apt-get install gawk
- [X] install proj.4
    wget http://download.osgeo.org/proj/proj-4.9.1.tar.gz
    mkdir ~/proj
    mv Download/proj-4.9.1.tar.gz ~/proj/
    tar -zxvf proj-4.9.1.tar.gz
    cd proj-4.9.1
    sudo ./configure
    sudo make
    sudo make install

** Installation of Atlantis
*** Checkout [3/3]
- [X] cd  /home/demiurgo/Documents/2015/Atlantis_Model
- [X] Checkout Atlantis
  svn co  https://svnserv.csiro.au/svn/atlantis/Atlantis/trunk/
- [X] Checkout SETas
  svn co  https://svnserv.csiro.au/svn/atlantis/runFiles/trunk/SETas_model_New_Trunk/

*** Update [0/2]
- [ ] Update
    svn update SETas_model_New
    svn update trunk
- [ ] If I udate I need to build atlantis again

*** Build Atlantis [9/9]
# to build Atlantis I need t compile and run using aototools
- [X] cd  /home/demiurgo/Documents/2015/Atlantis_Model/trunk/atlantis
- [X] aclocal
- [X] autoconf
- [X] automake -a               # I have some problems with this section
- [X] autoreconf  -fvi          # you can use this instead of the other ones
- [X] sudo chmod +x configure   # Change the permissions to the configure script
- [X] ./configure
- [X] make
- [X] sudo make install
*** Chanche between DOS-mode to UNIX-mode [2/2]
 - It is necesary to change the mode of the codification of the text files of the setas folder
 - [X] cd /home/demiurgo/Documents/2015/Atlantis_Model/SETas_model_New/
 - [X] flip -uvt *.*
 ------
* Runing Atlantis
** Nescesary files
- [ ] atlantisMerged
- [ ] init_vmpa_setas_25032013.nc
- [ ] outputSETAS.nc
- [ ] VMPA_setas_run_fishing_F_Dem.prm
- [ ] VMPA_setas_force_fish_Dem.prm
- [ ] VMPA_setas_physics.prm
- [ ] VMPA_setas_biol_fishing_Dem.prm
- [ ] VMPA_setas_harvest_F_New.prm
- [ ] SETasGroupsDem_NoCep.csv
- [ ] SETasFisheries.csv
- [ ] outputFolderTrunk
** Run the model called the SETas (Unix != DOS)
 -  atlantisMerged -i init_vmpa_setas_25032013.nc 0 -o outputSETAS.nc -r VMPA_setas_run_fishing_F_Dem.prm -f VMPA_setas_force_fish_Dem.prm -p VMPA_setas_physics.prm -b VMPA_setas_biol_fishing_Dem.prm -h VMPA_setas_harvest_F_New.prm -s SETasGroupsDem_NoCep.csv -q SETasFisheries.csv -d outputFolderTrunk

    ------
* Zones
** using Qgis for the definition of the polygos
** The polygons are defined by species distribution, managemet areas and Oceanography
*** The polygons need to have
1. Each box must have a "box_id" integer attribute, which must be consecutively numbered, starting from 0.  The absence of this attribute, or any gaps in the numbering, cause the transformation to abort.
2. Each box must have a "boundary" integer attribute.  This should be set to 1 for every boundary box, and 0 otherwise.  The absence of this attribute will cause the transformation to abort.  It will also abort if box 0 is not marked as a boundary box, or if box 1 is marked as a boundary box.  Note: the tool does not at the moment attempt to verify that a boundary box is in fact on the boundary.
3. Each box must have a botz float attribute, which will be used in the bathymetry.  It may be either negative or positive, but will always be converted to negative.  It will also accept "depth" if botz is not found.
4. Each box can (read: "should") have a "vertmix" numeric attribute. If it is not present NaN will be used and you will have to add it correct it manually later.
5. Each box can (read: "should") have a "horizmix" numeric attribute. If it is not present NaN will be used and you will have to add it correct it manually later.
6. Islands should be represented as boxes with a depth of 0, not as empty regions. The conversion will abort if islands are detected.
7. File need to looks like
| box_id | Bounday | botz   | horizmix |     vermix |     area |
|--------+---------+--------+----------+------------+----------|
|      0 |       1 | - 4500 |        1 | 0.00000001 |  7945687 |
|      1 |       0 | - 3600 |        1 | 0.00000001 | 45389345 |
|      2 |       1 | - 4500 |        1 | 0.00000001 |   987728 |
|        |         |        |          |            |          |
|        |         |        |          |            |          |
** I generate a Shape file with the poligons. I need to know:
- Shape file from QGIS
- UTM projection - For Juan Fernandez is UTM 17H South

- check the shp file
v.in.ogr "dsn=/home/demiurgo/Documents/2015/Polygonos/qgis-project/JFR.shp" output=JFR0p001 snap=0.0001 min_area=0.0001 -o
- Using the Java lybrarie I need to run the follow code
rm JFRE_ll.bgm
java -jar bgmeriser-stripped.jar -as "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs" JFRE_v3.shp JFRE_ll.bgm

rm JFRE_xy.bgm
java -jar bgmeriser-stripped.jar -from "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"  -to "+proj=utm +zone=19 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs" JFRE_v3.shp JFRE_xy.bgm

------
* Oceanography
** I will use the Roms model
** The variables that I plan tu use are:
- CHLA
- temperature
- NO3
- w
- Salinity
** Getting the physics
*** Getting the code
   - svn co https://svnserv.csiro.au/svn/atlantis/Matlab/hydro/trunk/Public
   - I need to use my CSIRO account
*** Running the code
**** The layer that I create are based on the biology of the species and in the structure of the BMG file
- the max depth in the model need to be less than the max depth usen in the BMG file
**** Two steps to get the Oceanography, I'm using one file called roms2atlantis.m who is devided in three part:
***** Folders
- codes : '/home/demiurgo/Documents/2015/Atlantis_Model/tools/physics/Codes'
- ROMS  : '/media/demiurgo/TOSHIBA EXT/Data_fisica_AJF/ROMS/avg/**YEAR**'/Parent files
- outputs:
  - .mat files : '/home/demiurgo/Documents/2015/Oceanography/physics/output/**YEAR**'/'
  - .nc files  : '/home/demiurgo/Documents/2015/Oceanography/physics/output/Netcdf_out/'
***** Getting the polygos
- It is necesary to call the BMG file to obtatin the information of the polygons, to do this I use the function 'read.boxes'
- To calculate the transpors its necesary to know the faces of the polygos, for that I use the read_faces2 function
- Its  Necesary to define the layer depth, in my case and based on Biology and Oceanography I select 8 levels
****** Code In matlab
#+begin_src matlab
BGM_JFR_ll = '/home/demiurgo/Documents/2015/Oceanography/physics/BMG_files/JFRE_ll.bgm';
[nbox,nface,bid,cent,b_area,verts,iface, botz] = read_boxes(BGM_JFR_ll);
[nulr,nupt1,nupt2] = read_faces2(nbox, nface, bid,verts, iface, BGM_JFR_ll);


iface      = iface;  %% Id of the faces
lr         = nulr;   %% Neightbourn Layers
pt1        = nupt1;  %% Face 1
pt2        = nupt2;  %% Face 2
irealfaces = find(~isnan(nupt1(:,1)));  % (ie those ref'd in box definitions)
fcid       = (irealfaces-1);
rimn       = 10;     % default 3 is probably too few
dinc       = 1;      %% 0.1;   % default 10km is probably ok, esp for large boxes
                      % May want to reduce the face integration step 'dinc' for models with
                      % small or narrow boxes.
dlev = [0 20 50 150  250 400 650 1000 4300]; %% This structure is related with
                                             % the biology and with the
                                             % maximum deph in the BMG model
#+end_src

****** Functions
- read_boxes()
- read_faces2()
- transport_JFRE()
  - netcdf()      # NETCDF library
  - sigma2zeta()  # Depth at sigma layer based in the maximum depth
  - cart2pol()    # cartesian to polar (cilindrical) coordinates
  - cosd()        # cosine in degree
  - av2()         # grid average
  - rot2d()       # Rotate vectors by geometrics angle
  - Generic functions from matlab
- write_trans_file()
- box_av_JFRE
  - netcdf()
  - sigma2zeta()
- write_av_var()
***** Getting the transport
- I transform the transport in sigma layers to the depth layer in the JFRE polygons
- I devided the transport by years
- The function transport_JFRE it a bit hardcoded
- The output ist a netcd file
****** Code
#+begin_src matlab
%% Running the model - saving by years %%
%% Transport between layers
for year = 2000 : 2008
    direc = (['/media/demiurgo/TOSHIBA EXT/Data_fisica_AJF/ROMS/avg/', num2str(year), '/']);
    files = dir([direc, 'nest_avg_parent.*']);
    guard = (['/home/demiurgo/Documents/2015/Oceanography/physics/output/Netcdf_out/JFRE_Transport', num2str(year), '.nc']);
    cd (['/home/demiurgo/Documents/2015/Oceanography/physics/output/', num2str(year),'/']);
    for nfile = 1 : length(files)
        fnm         = [direc, files(nfile).name];
        [T, nctime] = transport_JFRE(verts, pt1, pt2, dlev, dinc, rimn, nfile, year, fnm);
    end
    t_files = dir('*third_Step.mat');
    for f = 1 : length(t_files)
        load(t_files(f).name)
        if f == 1
            Tfinal = T;
            nctime = tims;
        else
            Tfinal = cat(2, Tfinal, T);
            nctime = cat(1, nctime, tims);
        end
    end
    save('Tfinal.mat', 'Tfinal', 'nctime');
    % writing the NETCDF file
    write_trans_file(pt1, pt2, lr, nctime, Tfinal, fcid, guard)
end

#+end_#+begin_src language

#+end_src

***** Getting variables
- To variables stracted are the mean by layer and by polygons
- the variables were saved by year
- The output ist a netcd file
****** Code
 - Base code

#+begin_src matlab
varn = {'temp';  'salt';  'w';  'CHLA';   'NO3'}
for v  =  1 : length(varn)
    for year = 2000 : 2008
        avname  = char(varn(v));
        direc = (['/media/demiurgo/TOSHIBA EXT/Data_fisica_AJF/ROMS/avg/', num2str(year), '/']);
        files = dir([direc, 'nest_avg_parent.*']);
        guard = (['/home/demiurgo/Documents/2015/Oceanography/physics/output/Netcdf_out/JFRE_', num2str(year), avname, '.nc'])
        cd (['/home/demiurgo/Documents/2015/Oceanography/physics/output/', num2str(year),'/'])
        for nfile = 1 : length(files)
            fnm   = [direc, files(nfile).name];
            box_av_JFRE(verts, avname, dlev, nfile, year,  fnm)
        end
        t_files = dir(['*', avname, '_JFRE.mat']);
        for f = 1 : length(t_files)
            load(t_files(f).name)
            if f == 1
                Av_final = Var_avg;
                nctime   = tims;
            else
                Av_final = cat(2, Av_final, Var_avg);
                nctime   = cat(1, nctime, tims);
            end
        end
        file.save = ([num2str(year), '_Av_', avname, '.mat'])
        save(file.save, 'Av_final', 'nctime')
        % writing the NETCDF file
        write_av_var(nctime, bid, avname, Av_final, guard)
    end
end
#+end_#+begin_src language

#+end_src

** Using Hydrocontruct
*** Getting the code
- svn co https://svnserv.csiro.au/svn/atlantis/HydroConstruct
**** Installing Hydro under ubuntu
  - nescesary dev files for ubuntu
    - sudo apt-get install libcunit1-dev
  - autotools for build and compile
    - aclocal
    - autoheader
    - autoconf
    - automake -a
    - ./configure
    - make
    - sudo make install

**** running hydrocontruct
***** Setting hydrocontruct
      - For this you need to use the .prm, this file contain all the settings
      - be careful to use the layer thikness and not the comulative depth
     #+BEGIN_SRC sh
       # Message level setting: 0 = no messages, 1 = step-by-step
       # reporting on program progress
       verbose 0
       # read back exchanges per box
       verbose_exchange 0
       verbose_box 0
       # read back dates used to pad out the timeseries
       verbose_pad 0
       ## General characteristics for flows
       # use unidirectional flows (so negative flow from A to B recast as positive flow from B to A)
       # either setting ok if flows reporting as net flow across faces, but if have gross flows set to 0
       unidirectional_flow 0
       # rewind file between reading lines (0=no which is faster, 1=yes which is safer)
       rewind 1
       # Generic code used (1) or hardwired read in (0)
       generic 1
       # Geometry file being used by boxmodel
       geofile JFRE_xy.bgm
       # File with lat-long coordinates of the faces in it - only really needed if using netcdf input data
       llgeofile JFRE_ll.bgm
       # Recycle flows through time
       recycle_flow 0
       # Slow diffusion (0 flows replaced by 0.0000001 flows) allowed (0=no, 1=yes)
       slow_diffusion 0
       # Assumed vertical diffusion allowed (0=no, 1=yes)
       vert_diffusion 0
       # Assumed (minimal) back diffusion allowed (0=no, 1=yes)
       back_diffusion 0
       # Reference year - exchanges etc are referenced from 07-01-2000 (MM-DD HH:MM:SS) of this year
       reference_year 2000
       # Start time of output file (days) starts on the 07-Jan-2000 11:48:16
       tstart 0
       # End time of output file (days) ends on the 30-Dec-2008 12:22:24
       tstop 656
       # Time step of the output file (seconds) <=> 5 days
       dt 432000
       # Reset time so start at time zero rather than t = .... in file
       reset_time 1
       # Total (maxiumum) number of water column layers
       wcnz 8
       # Default water column layer thickness
       default_layer_dz 8
       20 30 100 100 150 250 350 3300
       # Number of water column layers per box
       numlayers 51
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 6 6 6 6 6 6 6 4 4 4 4 8 8 4 4 4 4 0 6 6 0 6 5
       # Boundary flag and boundary type (0 = non-boundary, 1 = normal boundary, 2 = absorptive, 3 = reflective)
       boundaries 51
       1 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 1 0 0
       # In addition to any scaling below, flows are area corrected to try and avoid hyperdiffusion (0 = no, 1 = yes, 2 = yes, with respect to the shape of the box)
       area_correct_flow 1
       area_correct_vflow 0
       # Scaling of flow per box (e.g. -1.0 to reverse flows)
       box_scaling 51
       1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
       ## Horizontal flow information
       # Number of destination cells
       ndest 204
       # Missing data value (flows < than -(this value) will be ignored)
       missing_data -9999999999
       # Number of data entries per line
       n_inline 1
       # Data type (0 = Al Herman NOAA format, 1 = CSIRO flat format, 2 = CSIRO netcdf format)
       input_type 2
       # Units for flow data (0 = Sverdrups, 1 = m3/s)
       unit_type 1
       # Number output files
       numoutfile 1
       ## Hydrodynamic files
       nhdfiles 1
       trans0.name JFRE_Transport.nc
       # Number of faces representing estuaries where need to "by hand" specify flows
       num_estuaries 0
       # Estuarine face ids (face numbers in geofile that define estuary mouth) - must have as many entries as specified by num_estuaries
       # or at least 1 entry, which ever is smaller
       river_ids 1
       0
       # Estuarine fluxes - must have as many entries as specified by num_estuaries
       # or at least 1 entry, which ever is smaller. Rates must be in the same units as in the raw data files
       river_influxes 1
       0
       river_outfluxes 1
       0
       ## Vertical exchange files
       nvhdfiles 0
       vtrans0.name JFRE_2000v.nc
       ## Temperature and Salinity file information
       # Temperature missing data values (temperatures < than -(this value) will be ignored)
       temp_missing_data 1
       # Salinity missing data values (salinities < than -(this value) will be ignored)
       salt_missing_data 1
       # Flag indicating whether absolute values or fluxes of temperature and salinity used
       # (0 = absolute values, 1 = fluxes added to init values, 2 = fluxes summed)
       tsflagflux 0
       # Temperature and salinity profile files
       ntsfiles 1
       tempsalt0.name JFRE_Variables.nc
       pad_time 0
       ph_missing_data 0
     #+END_SRC
***** running hydrocontruc
#+BEGIN_SRC sh
#!/bin/bash
sudo make install -C /home/demiurgo/Documents/2015/Oceanography/physics/Codes/Contruct/HydroConstruct/trunk/
if [ $? -eq 0 ] ; then
    #valgrind --leak-check=full --log-file=Valgrind.%p --show-reachable=yes
    #gdb --args
    HydroConstruct -f flowout.cdf -t tempout.cdf -s saltout.cdf -r parameters.prm

    mkdir Salida_Atlantis
    mv saltout.cdf  Salida_Atlantis
    mv tempout.cdf  Salida_Atlantis
    mv flowout.cdf  Salida_Atlantis/flowout.cdf
    mv volume1.cdf  Salida_Atlantis/volume.cdf

    cd  Salida_Atlantis
    ncgen -o JFRE_temp.nc tempout.cdf
    ncgen -o JFRE_salt.nc saltout.cdf
    ncgen -o JFRE_hydro.nc flowout.cdf

    cd ..


else
    echo 'Failed to compile hydro construct'

fi
#+END_SRC

** physics parameter file
- Settings of the Oceanography file
  #+CAPTION: Parameters used in Atlantis
    | Parameter        | Original Value   | Atlatnis value        | Reference    | Comment                                                                                   |
    |------------------+------------------+-----------------------+--------------+-------------------------------------------------------------------------------------------|
    | All for SEdiment | Atlantis default | Atlantids defaul      | Beth         | I kept the same values. I will calibrate the ecology first                                |
    | eddy seasons     | 1                | Use calculated values | oceano.tools | It important to check the same result than andrade, for the spring increase of cholrofila |
    | eddy vertmix     | 0                | 0                     | Beth         | It is necesary to change to 1 to represnet the effect of the eddies                       |
    | other parameter  | No-variation     | Same than atlantis    |              |                                                                                           |

***** nw------
* Setting Atlantis
** CSV files
*** SETasfishery
**** Bycatch
 - It is necesary put the bycatch species in the model as a fisheries?
 - The Dynamic can be compelte different if we dont take into account this factor
**** Fisheries
 - Configuration of the Fisheries parameter files
     #+CAPTION: Parameter used in the configuration of the fisheries parameter files
      | Code         | Index | Name                            | IsRec | NumSubFleets |
      |--------------+-------+---------------------------------+-------+--------------|
      | trapSPL      |     1 | trap spiny lobster              |     0 |            0 |
      | trapGCR      |     2 | trap golden crab                |     0 |            0 |
      | llBRC        |     3 | long line breca                 |     0 |            0 |
      | trawORO      |     4 | trwal orange roughy             |     0 |            0 |
      | trawALF      |     5 | trawl alfonsino                 |     0 |            0 |
      | llLPF        |     6 | long line large pelagic fish    |     0 |            0 |
      | hlineLPF     |     7 | hand line Large pelagic fish    |     0 |            0 |
      | recVID[fn:1] |     8 | recreational Vidriola           |     1 |            0 |
      | recLPF[fn:1] |     8 | recreational large pelagic fish |     1 |            0 |
      | hlineSPF     |     9 | hand line small pelagic fish    |     0 |            0 |
      | llSBF        |    10 | long line small benthic fish    |     0 |            0 |
      | trapLBF      |    11 | Trap large benthic fish         |     0 |            0 |
      | llLBF        |    12 | Trap large benthic fish         |     0 |            0 |
       [fn:1] Recreational fisheries with spears only in summer
*** SETasGroups
**** Functional groups
| Code  | Functional Groups  | Common name       | Sc. Name                              |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *SPL* | Langosta           | Langosta de J.F.  | /Jasus frontalis/                     |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *GCR* | Cangrejo Dorado    | Cangrejo Dorado   | /Chaceon chilensis/                   |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *BRC* | Breca              | Breca             | /Nemadactylus gayi/                   |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *ANG* | Anguila            | Anguila           | /Gymnothorax porphyreus/              |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *VID* | Vidriola           | Vidriola          | /Seriola lalandi/                     |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *ALF* | Alfonsino          | Alfonsino         | /Beryx splendens/                     |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *ORO* | Orange Roughy      | Orange Roughy     | /Hoplostethus atlanticus/             |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *OCT* | Pulpo              | Pulpo de  J.F.    | /Octopus crusoe/                      |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *CHO* | Chondricties       | Tollo             | /Squalus mitsukuri/                   |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *OTA* | Otaridee           | Lobo de J.F.      | /Actocephalus phillippi/              |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *SPF* | Small Pelagic Fish | Pampanito         | /Scorpis chilensis/                   |   |
|       |                    | Graniento         | /Caprodon longimanus/                 |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *LPF* | Large Pelagic Fish | Corvina de J.F.   | /Umbrina reedi/                       |   |
|       |                    | Jurel de J.F.     | /Pseudocaranx chilensis/              |   |
|       |                    | Sierra            | /Thyrsites atun/                      |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *SBF* | Small Benthic Fish | Colorado          | /Plectranthias exsul/                 |   |
|       |                    | Cabrilla          | /Chironemus delfini/                  |   |
|       |                    | Chancharro        | /Helicolenus lengerichi/              |   |
|       |                    | Pez Mariposa      | /Pterygotrigla picta/                 |   |
|       |                    | Jerguilla de J.F. | /Girella albostriata/                 |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *LBF* | Large Benthic Fish | Bacalado de J.F.  | /Polyprion oxigeneios fernandezianus/ |   |
|       |                    | Lenguado          | /Paralichthys fernandezianus/         |   |
|       |                    | Congrio           | /Lotella fernandeziana/               |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *MOL* | Mollusca           | Caracol blanco    | /Fusitritron magellanicum/            |   |
|       |                    | Ostra             | /Nucula fernandeziana/                |   |
|       |                    | Loco              | /Concholepas sp/                      |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *SCR* | Small Crustacean   | Centolla de J.F.  | /Paraloma rathbuni/                   |   |
|       |                    | Jaiva             | /Talifrus dentatus/                   |   |
|-------+--------------------+-------------------+---------------------------------------+---|
| *SUR* | Sea Urchin         | Erizo             | /Centrostephanus rodgersii/           |   |
|       |                    | Estrella de mar   | /Patiriella calcarata/                |   |

**** JFRE_biol.csv file configuration
     #+CAPTION: Configuration file with all the functional groups
      | Code | Index | IsTurnedOn | Name                 | Long Name            | NumCohorts | NumGeneTypes | NumStages | NumSpawns | NumAgeClassSize | NumStocks | MovesVertically | MovesHorizontally | isFished | IsImpacted | isTAC | GroupType    | isPredator | IsCover | isSiliconDep | isAssessed | IsCatchGrazer | isOverWinter | isCultured | isHabDepend |
      |------+-------+------------+----------------------+----------------------+------------+--------------+-----------+-----------+-----------------+-----------+-----------------+-------------------+----------+------------+-------+--------------+------------+---------+--------------+------------+---------------+--------------+------------+-------------|
      | SPL  |     0 |          1 | Spiny_lobster        | Spiny lobster        |         10 |            1 |         2 |         1 |               4 |         2 |               0 |                 1 |        1 |          1 |     0 | FISH_INVERT  |          1 |       0 |            0 |          1 |             0 |            0 |          0 |           0 |
      | GCR  |     1 |          1 | Golden_Crab          | Golden Crab          |         10 |            1 |         2 |         1 |               4 |         2 |               0 |                 1 |        1 |          1 |     0 | FISH_INVERT  |          1 |       0 |            0 |          1 |             0 |            0 |          0 |           0 |
      | BRC  |     2 |          1 | Breca                | Breca                |         10 |            1 |         2 |         1 |               2 |         2 |               1 |                 1 |        1 |          1 |     0 | FISH         |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | VID  |     3 |          1 | Vidriola             | Vidriola             |          3 |            1 |         2 |         1 |               2 |         1 |               1 |                 1 |        1 |          1 |     0 | FISH         |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | ORO  |     4 |          1 | Orange_Roughy        | Orange Roughy        |         10 |            1 |         2 |         1 |              15 |         1 |               1 |                 1 |        1 |          1 |     1 | FISH         |          1 |       0 |            0 |          1 |             0 |            0 |          0 |           0 |
      | ALF  |     5 |          1 | Alfonsino            | Alfonsino            |         10 |            1 |         2 |         1 |               2 |         1 |               1 |                 1 |        1 |          1 |     1 | FISH         |          1 |       0 |            0 |          1 |             0 |            0 |          0 |           0 |
      | ANG  |     6 |          1 | Anguila              | Anguila              |         10 |            1 |         2 |         1 |               4 |         1 |               1 |                 1 |        1 |          1 |     0 | FISH         |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | CHO  |     7 |          1 | Chondrichtyans       | Chondrichtyans       |          1 |            1 |         2 |         1 |               1 |         1 |               1 |                 1 |        0 |          1 |     0 | SHARK        |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | OTA  |     8 |          1 | Otariid              | Otariid              |         10 |            1 |         2 |         1 |               3 |         2 |               1 |                 1 |        0 |          1 |     0 | MAMMAL       |          1 |       0 |            0 |          1 |             0 |            0 |          0 |           0 |
      | DOL  |     9 |          1 | Dophins              | Dophins              |          1 |            1 |         2 |         1 |               1 |         1 |               1 |                 1 |        0 |          0 |     0 | MAMMAL       |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | CET  |    10 |          1 | Whales               | Whales               |          1 |            1 |         2 |         1 |               1 |         1 |               1 |                 1 |        0 |          0 |     0 | MAMMAL       |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | BIR  |    11 |          1 | Birds                | Birds                |          1 |            1 |         1 |         1 |               1 |         1 |               1 |                 1 |        0 |          0 |     0 | BIRD         |          1 |       0 |            0 |          1 |             0 |            0 |          0 |           0 |
      | OCT  |    12 |          1 | Octupus              | Octupus              |          1 |            1 |         1 |         1 |               1 |         1 |               1 |                 1 |        0 |          1 |     0 | CEP          |          1 |       0 |            0 |          0 |             1 |            0 |          0 |           0 |
      | LPF  |    13 |          1 | Pelagic_L_fish       | Large pelagic fish   |         10 |            1 |         2 |         1 |               4 |         1 |               1 |                 1 |        1 |          1 |     0 | FISH         |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | SPF  |    14 |          1 | Pelagic_S_fish       | Small pelagic fish   |         10 |            1 |         2 |         1 |               1 |         1 |               1 |                 1 |        1 |          1 |     0 | FISH         |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | SBF  |    15 |          1 | Benthic_S_fish       | Small benthic fish   |         10 |            1 |         2 |         1 |               2 |         1 |               1 |                 1 |        1 |          1 |     0 | FISH         |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | LBF  |    16 |          1 | Benthic_L_fish       | Large benthic fish   |         10 |            1 |         2 |         1 |               3 |         1 |               1 |                 1 |        1 |          1 |     0 | FISH         |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | SZO  |    17 |          1 | Small_zooplankton    | Small Zooplankton    |          1 |            1 |         1 |         1 |               1 |         1 |               1 |                 1 |        0 |          0 |     0 | MED_ZOO      |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | MZO  |    18 |          1 | Med_zooplankton      | Medium Zooplankton   |          1 |            1 |         1 |         1 |               1 |         1 |               1 |                 1 |        0 |          0 |     0 | MED_ZOO      |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | LZO  |    19 |          1 | Large_zooplankton    | Large Zooplankton    |          1 |            1 |         1 |         1 |               1 |         1 |               1 |                 1 |        0 |          0 |     0 | LG_ZOO       |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | SCR  |    20 |          1 | Small_crus           | Small crustaceans    |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          1 |     0 | MOB_EP_OTHER |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | BFF  |    21 |          1 | Deposit_feeders      | Deposit feeders      |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          1 |     0 | LG_INF       |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | LPH  |    22 |          1 | Large_phyto          | Large phytoplankton  |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | LG_PHY       |          0 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | SPH  |    23 |          1 | Small_phyto          | Small phytoplankton  |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | SM_PHY       |          0 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | SUR  |    24 |          1 | Sea_urchins          | Sea urchins          |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | SED_EP_FF    |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | MOL  |    25 |          1 | Mollusca             | Mollusca             |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | SED_EP_FF    |          1 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | NO   |    26 |          1 | Nitrate              | Nitrate              |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | NIT          |          0 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | MA   |    27 |          1 | Macroalgae           | Macroalgae           |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | PHYTOBEN     |          0 |       1 |            0 |          0 |             0 |            0 |          0 |           0 |
      | PB   |    28 |          1 | Pelag_Bact           | Pelagic Bacteria     |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | PL_BACT      |          0 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | BB   |    29 |          1 | Sed_Bact             | Sediment Bacteria    |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | SED_BACT     |          0 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | DL   |    30 |          1 | Labile_detritus      | Labile detritus      |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | LAB_DET      |          0 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | DR   |    31 |          1 | Refractory_detritrus | Refractory detritrus |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | REF_DET      |          0 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |
      | DC   |    32 |          1 | Carrion              | Carrion              |          1 |            1 |         1 |         1 |               1 |         1 |               0 |                 0 |        0 |          0 |     0 | CARRION      |          0 |       0 |            0 |          0 |             0 |            0 |          0 |           0 |

**** Information functional groups
***** lifespans
 - Whit this I set the number of cohorts and the number of Ageclass
     | FG  | Maximum Age (years) | Mat (years) | Cohort | AgeClasses | Ref                 |
     |-----+---------------------+-------------+--------+------------+---------------------|
     | SPL |               40-50 |           8 |     10 |          4 | Simulation model    |
     | GCR |                  40 |           8 |     10 |          4 | Other species       |
     | BCR |                  30 |           5 |     10 |          3 | Estimation          |
     | VID |                  12 |           2 |      3 |          2 | fishbase            |
     | ORO |                 149 |          33 |     10 |         15 | Fishbase            |
     | ALF |                  23 |           5 |     10 |          2 | Fishbase            |
     | ANG |                  38 |           7 |     10 |          4 | Fishbase            |
     | OTA |                  30 |           3 |     10 |          3 | ANNALISA BERTA 1989 |
     | LPF |                  40 |           4 |     10 |          4 | Fishbase            |
     | SPF |                  10 |           3 |     10 |          1 | Fishbase            |
     | SBF |                  24 |           4 |     10 |          2 | Fishbase            |
     | LBF |                  30 |           3 |     10 |          3 | Fishbase            |

***** Growth and Age
 -  *Orange Roughy*
   -  *Male*

     | Source      | N-sample | Age Range | length type |  Linf |      K |     to |
     |-------------+----------+-----------+-------------+-------+--------+--------|
     | FIP 2000-12 |     1516 |           | Fork        | 47.86 | 0.0374 | -1.414 |
     |             |     1516 |           | Standar     | 43.68 | 0.0372 | -1.639 |

   -  *Female*

     | Source      | N-sample | Age Range | length type | Linf |      K |     to |
     |-------------+----------+-----------+-------------+------+--------+--------|
     | FIP 2000-12 |     1554 |           | Fork        | 53.8 | 0.0304 | -1.691 |
     |             |     1554 |           | Standar     |   49 | 0.0303 | -1.973 |

   -  *Both sex*

    | Source      | N-sample | Age Range | length type |  Linf |      K |     to |
    |-------------+----------+-----------+-------------+-------+--------+--------|
    | FIP 2000-12 |     1890 |           | Fork        | 52.13 | 0.0313 | -1.716 |
    |             |     1890 |           | Standar     | 47.51 | 0.0303 |     -2 |

   - *Re-contruction of grwoth curves*
    #+BEGIN_SRC R  :results output
      ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
      ## ~                von Bertalanffy growth equation             ~ ##
      ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
      library(ascii)
      options(asciiType="org")
      ## function
      vb <- function(linf, k, to, age){
          l <- linf * (1 - exp(-k * (age - to)))
          return(l)
      }
      ## the configuration for Orange roughy is 10 cohort of 10 age class
      ## estimation based on paramter from Edwin report
      Age  <- seq(from = 1, to = 149, length = 10)
      l    <-  vb(linf = 52.13,  k    = 0.0313,
                  to   = -1.716, age  = Age)
      out <- data.frame(Age = round(Age, 0), Fork.Length = l)

      b   <- ascii(out, header = T, include.rownames = FALSE, include.colnames = T)
      print(b)
    #+END_SRC

    #+RESULTS:
    #+CAPTION: Age growth relationship
      |    Age | Fork.Length |
      |--------+-------------|
      |   1.00 |        4.25 |
      |  17.00 |       23.51 |
      |  34.00 |       35.03 |
      |  50.00 |       41.91 |
      |  67.00 |       46.02 |
      |  83.00 |       48.48 |
      | 100.00 |       49.95 |
      | 116.00 |       50.83 |
      | 133.00 |       51.35 |
      | 149.00 |       51.66 |
 -  *Alfosino*
   -  *Male*
     | Source      | N-sample | Age Range | length type |  Linf |     K |     to |
     |-------------+----------+-----------+-------------+-------+-------+--------|
     | FIP 2000-12 |      671 |      1-15 | Fork        | 58.54 | 0.106 | -2.393 |


   -  *Female*
     | Source      | N-sample | Age Range | length type |  Linf |     K |     to |
     |-------------+----------+-----------+-------------+-------+-------+--------|
     | FIP 2000-12 |      706 |      1-19 | Fork        | 63.59 | 0.095 | -2.458 |


   -  *Both sex*

      | Source      | N-sample | Age Range | length type |  Linf |      K |     to |
      |-------------+----------+-----------+-------------+-------+--------+--------|
      | FIP 2000-12 |     1377 |      1-19 | Fork        | 63.39 | 0.0928 | -2.567 |

   -  *Re-contruction of grwoth curves*
         #+BEGIN_SRC R  :results output
           ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
           ## ~                von Bertalanffy growth equation             ~ ##
           ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
           library(ascii)
           options(asciiType="org")
           ## function
           vb <- function(linf, k, to, age){
               l <- linf * (1 - exp(-k * (age - to)))
               return(l)
           }
           ## the configuration for Alfonsino is 10 cohort
           ## estimation based on paramter from Edwin report
           Age  <- seq(from = 1, to = 19, length = 10)
           l    <-  vb(linf = 63.39,  k    = 0.0928,
                       to   = -2.567, age  = Age)
           out <- data.frame(Age = round(Age, 0), Fork.Length = l)

           b   <- ascii(out, header = T, include.rownames = FALSE, include.colnames = T)
           print(b)
         #+END_SRC

         #+RESULTS:
      #+CAPTION:  Growth Alfonsino
         |   Age | Fork.Length |
         |-------+-------------|
         |  1.00 |       17.86 |
         |  3.00 |       25.58 |
         |  5.00 |       31.98 |
         |  7.00 |       37.30 |
         |  9.00 |       41.72 |
         | 11.00 |       45.39 |
         | 13.00 |       48.44 |
         | 15.00 |       50.97 |
         | 17.00 |       53.08 |
         | 19.00 |       54.82 |

***** Growth-Weight
 - *Orange Roughy*
   -  *Male*
      | Source      | N-sample |   Winf |      K |    to |
      |-------------+----------+--------+--------+-------|
      | FIP 2000-12 |     1516 | 3180.6 | 0.0130 | 1.745 |

   - *Female*
     | Source      | N-sample |   Winf |      K |    to |
     |-------------+----------+--------+--------+-------|
     | FIP 2000-12 |     1554 | 4989.9 | 0.0091 | 1.925 |

   - *Both sex*
     | Source      | N-sample |   Linf |     K |    to |
     |-------------+----------+--------+-------+-------|
     | FIP 2000-12 |     1890 | 4956.9 | 0.008 | 2.064 |

***** Natural mortality (M)
 -  *Orange Roughy*
   | Source      | Sex    | Value |
   |-------------+--------+-------|
   | FIP 2000-12 | Male   | 0.053 |
   |             | Female | 0.047 |

 -  *Alfonsino*
   | Source      | Sex    | Value |
   |-------------+--------+-------|
   | FIP 2000-12 | Male   | 0.162 |
   |             | Female | 0.152 |

** PRM files
*** Biology input file
**** Habitat dependence
 - The species that are cover are Coral and Macroalgae. Those are been reported that act as cover for juvenile lobster and juvenile bonny fishes.
| FG  | Stage | Kcov | Bcov | Acov |
|-----+-------+------+------+------|
| SPL | Both  |    3 |  0.6 | 1    |
| GCR | Both  |    3 |  0.6 | 1    |
| BRC | Juv   |    3 |  0.6 | 1    |
| LPF | Juv   |    3 |  0.6 | 1    |
| SPF | Both  |    3 |  0.6 | 1    |
| SBF | Both  |    3 |  0.6 | 1    |
| LBF | Juv   |    3 |  0.6 | 1    |

**** Acidification (Turnned off for calibration)
- Effect of ph in crustacean and other species.
- Acidification at the moment is settle to 1 (line 770)
  - There is effect on behavior in other species of crustacean

   | FG  | Temp | Ph | fecund | Predation |
   |-----+------+----+--------+-----------|
   | SPL |    1 |  1 |      1 |         1 |
   | GCR |    1 |  1 |      1 |         1 |
   | COR |    1 |  1 |        |           |
   | SCR |    1 |  1 |      1 |         1 |
   | MOL |    1 |  1 |        |           |
   | SZO |    1 |    |      1 |           |
   | MZO |    1 |    |      1 |           |
   | LZO |    1 |    |      1 |           |
   |     |      |    |        |           |

**** Diets
| FG  | Species                    | Reference               |
|-----+----------------------------+-------------------------|
| SPL | Jasus lalandii             | van Zyl et al. 1998     |
|     | Jasus lalandii             | Haley et al. 2011       |
|     | Jasus edwearsii            | Connell et al. 2014     |
|     | Jasus edwardsii            | Thesis Stewart gave me  |
|     | Jasus edwardsii            | O'Rorke et al. 2014     |
|-----+----------------------------+-------------------------|
| GCR | Chaceon notialis           | Fishbase                |
|     | Chaceon quinquedens        | Fishbase                |
|     | Chaceon ramosae            | Fishbase                |
|-----+----------------------------+-------------------------|
| BRC | Nemadactilys gayi          | Ramirez et al. 2013     |
|     | Nemadactilys gayi          | Ernst 2015              |
|-----+----------------------------+-------------------------|
| VID | Seriola lalandi            | Vergani et al,  2008    |
|     | Seriola lalandi            | [[http://fishesofaustralia.net.au/home/species/1662/][fishes of australia]]     |
|-----+----------------------------+-------------------------|
| ORO | Hoplostethus atlanticus    | Niklitschek 2009        |
|     | Hoplostethus atlanticus    | Labe and Arana 2001     |
|     | Hoplostethus atlanticus    | Fishbase                |
|     | Hoplostethus atlanticus    | Bulman and Kislow 1992  |
|     | Hoplostethus atlanticus    | Dunn and Forman 2011    |
|-----+----------------------------+-------------------------|
| ALF | Beryx splendens            | Horn et al. 2010        |
|     | Beryx splendens            | Fishbase                |
|     | Beryx splendens            | Durn and Gonzalez 2002  |
|-----+----------------------------+-------------------------|
| ANG | Lycodontis porphyreus      | Pizarro and Tiffou 1974 |
|     | Gymnothorax vicinus        | Young and Winn,  2003   |
|-----+----------------------------+-------------------------|
| CHO | Deep sea Squalus           | Dunn and Ferman 2011    |
|     | Squalus fernandinus        | Arana 1974              |
|     | Squalus mitsukurii         | Fishbase                |
|     | Squalus mitsukurii         | Cortes, 1999            |
|-----+----------------------------+-------------------------|
| OTA | Arctocephalus philippii    | Osman 2008              |
|     | Arctocephalus philippii    | EcuÃ±a and Francis 1995  |
|     | Arctocephalus philippii    | Diaz 2007               |
|-----+----------------------------+-------------------------|
| DOL | Delphinus delphis          | Pusineri et al. 2007    |
|     | Delphinus delphis          | Fishbase                |
|     | Tursiops truncatus         | Fishbase                |
|     | Globicephala macrorhynchus | Fishbase                |
|     | Delphinus delphis          | Brophy et al. 2006      |
|-----+----------------------------+-------------------------|
| CET | Orcinus Orca               | Ford et al 2016         |
|     | Orcinus orca               | Ford et al. 1998        |
|     | Kogia breviceps            | West et al. 2009        |
|     | Kogia breviceps            | Beatson 2007            |
|     | Balaenoptera physalus      | Landy et al 1991        |
|     | Balaenoptera physalus      | Fishbase                |
|     | Balaenoptera musculus      | Fishbase                |
|-----+----------------------------+-------------------------|
| BIR | Puffinus cretopus          | Azocar et al. 2013      |
|-----+----------------------------+-------------------------|
| SQD | Dosidicus gigas            | Fishbase                |
|     | vampyroteuthis infernalis  | Fishbase                |
|-----+----------------------------+-------------------------|
| OCT | Octopus crusoe             | Petit et al 2015        |
|     | Octopus mimus              | Fishbase                |
|     | Enteroctopus megalocyathus | Ibanez and Chong 2008   |
|     | Octopus vulgaris           | Smith 2003              |
|-----+----------------------------+-------------------------|
| LPF | Psudocaranx chilensis      | Ramirez et al 2013      |
|     | Psudocaranx chilensis      | Fishbase                |
|-----+----------------------------+-------------------------|
| SPF | Malapterus reticulatus     | Petit, 2014             |
|     | Scorpix chilensis          | Ramirez et al 2013      |
|     | Malapterus reticulatus     | Ramirez et al 2013      |
|     | Scartichthys variolatus    | Diaz and Munoz 2010     |
|     | Thyrsites atun             | Fishbase                |
|     | Callanthias sp.            | Fishbase                |
|-----+----------------------------+-------------------------|
| SBF | Hipoplectrodes semicinctum | Ramirez et al 2013      |
|     | Plectranthias sp           | Fishbase                |
|     | Aseraggodes sp.            | Fishbase                |
|     | Girella albostriata        | Fishbase                |
|     | Myctophidae                | Fishbase                |
|-----+----------------------------+-------------------------|
| LBF | Polyprion oxygeneios       | Pizarro and Tiffou 1974 |
|     | Aserragodes macleayanus    | Sumpton et al. 1990     |
|     | Polyprion oxygeneios       | Fishbase                |
|     | Paralabrax sp.             | Fishbase                |
|     | Paralichthys sp.           | Fishbase                |
|-----+----------------------------+-------------------------|
| SZO | microzooplankton           | Calbet et al. 2008      |
|     | Microzooplankton           | Burian et al. 2013      |
|-----+----------------------------+-------------------------|
| MZO | Mesozooplankton            | Baten et al. 2001       |
|     | Mesozooplankton            | Bode et al. 2004        |
|     | Mesozooplankton            | Wu et al. 2010          |
|     | Mesozooplankton            | Motwani et al. 2013     |
|-----+----------------------------+-------------------------|
| LZO | Euphausiid                 | Antezana, 2010          |
|-----+----------------------------+-------------------------|
| SCR | Projasus bahamondei        | Arana, 2014             |
|     | Paromola cuviieri          | Fishbase                |
|     | Chaceon quinquedens        | Steimle et al. 2001     |
|     | Ovalipes trimaculatus      | Fishbase                |
|-----+----------------------------+-------------------------|
| BFF | Polychaete                 | Jumars et al. 2015      |
|-----+----------------------------+-------------------------|
| MOL | Acanthopleura              | Camus et al. 2012       |
|     | Concholepas concholepas    | Stotz et al. 2003       |
|     | Arca sp.                   | Fishbase                |
|     | Aplysia sp.                | Fishbase                |
|-----+----------------------------+-------------------------|
| BCA | Sea Urchin                 | Fishbase                |
|     | Actinidae                  | Fishbase                |
|-----+----------------------------+-------------------------|
| COR | Deep waters coral          | Kiriakoulakis 2005      |
|-----+----------------------------+-------------------------|

**** Whater - Column parameters
- Light penetration through the water column
  -  *Ask Caly abouyt this*
**** Spatial Distribution
***** Horizontal variation
- Spatial distribution juvenile and adult (case of jurelilo-jurel)
  * For crustacean I used as division the maturity
     #+CAPTION: Size at maturity for some functional groups
    | FG  | Size at maturity (mm) | Reference                      |
    |-----+-----------------------+--------------------------------|
    | SPL |                  73.2 | Average (Rob + Selk) Data Base |
    | GCR |                 106.2 | Ernst 2013 report              |
    | BCR |                   282 | Thesis Ribara 2012             |

  * To use the information by weight I use the mean weight in the catches
     #+CAPTION: Mean catch wight for some functional groups
     | Functional Group | Mean weight (g) | Reference      |
     |------------------+-----------------+----------------|
     | Octopus          |             723 | Arancibia 2005 |
     | Breca            |             746 | Database       |
     | Anguila          |            1013 | Database       |

- *Distribution by zone*
  - *Orange Roughy*
    #+CAPTION: Distribution of Orange Roughy based on Nicklitschek 2007 (evaluacion hidroacustica alfonsino y orange)
       | Zone  |  2003 |  2004 |  2005 | 2006 | Average | Zones Atlantis |
       |-------+-------+-------+-------+------+---------+----------------|
       | JF1   |  2196 |  2019 |  9590 | 3749 |    4388 |    31,32,33,34 |
       | JF2   |  7246 |  6062 |  2847 | 2201 |    4589 |             30 |
       | JF3   |  4536 |  1905 |  1531 | 1565 |    2384 |             29 |
       | JF4   |  2981 |  1572 |  1586 |  492 |    1657 |             28 |
       | BO1   |       |   927 |  1813 |      |    1370 |             50 |
       | BO2   |       |   654 |   536 |      |     595 |             49 |
       |-------+-------+-------+-------+------+---------+----------------|
       | Total | 16959 | 13139 | 17903 | 8007 |         |                |
       |-------+-------+-------+-------+------+---------+----------------|
  - *Alfonsino*
    #+CAPTION: Distribution of Orange Roughy based on Nicklitschek 2007 (evaluacion hidroacustica alfonsino y orange). And proportion of Juvenile in the Catches
    | Zone  |  2005 |  2006 |         S1 |         S2 |         S3 |         S4 | Average | Zones atlantis |
    |-------+-------+-------+------------+------------+------------+------------+---------+----------------|
    | JF1   |  7608 | 11258 |  0.2196886 |  0.1952695 |  0.3574357 |  0.6673667 |    9433 |    31,32,33,34 |
    | JF2   | 10646 |  3112 | 0.05960596 | 0.05575558 | 0.42050872 | 0.96729673 |    6879 |             30 |
    | JF4   |   181 |   203 |  0.1396473 |  0.4303930 |  0.3107811 |   0.570357 |     192 |             28 |
    | JF6   |       |  3352 |  0.1396473 |  0.2271394 | 0.19006901 | 0.07640764 |    3352 |             47 |
    |-------+-------+-------+------------+------------+------------+------------+---------+----------------|
    | Total | 18435 | 17925 |            |            |            |            |         |                |
    |-------+-------+-------+------------+------------+------------+------------+---------+----------------|
  - *Chondricties*
     #+CAPTION: Distribution of Chondricties base on Andrade 2007 and 2008 biodiversity of seamount
          | Zone     | N/Presence | Zones       | Reference          |
          |----------+------------+-------------+--------------------|
          | JF1      | 10         | 31,32,33,34 | YaÃ±ez et al        |
          | JF2      | 1          | 30          |                    |
          | JF3      | Presence   | 29          | Andrade et al 2008 |
          | JF4      | Presence   | 28          | Andrade et al 2008 |
          | Robinson | Presence   | 35,36,37,38 | Arana  2000        |
          | Selkirk  | Presence   | 41,42,43,44 | Arana 2000         |
  - *Cetaceus*
    - Information from Aguayo et al 1998. I use the map provided in the manuscript as a proxi for the spatial location
  - *Table distribution functional groups*
      | ZONE        | 0 |     1 | 2 | 3 | 4 |     5 | 6 | 7 | 8 | 9 |    10 | 11 | 12 | 13 | 14 | 15 |    16 | 17 |    18 |    19 | 20 | 21 |    22 |    23 |    24 |    25 |    26 |    27 |    28 |    29 |    30 |    31 |    32 |    33 |    34 |    35 |    36 |    37 |    38 |    39 | 40 |    41 |    42 |    43 |    44 |    45 | 46 |    47 | 48 |   49 |    50 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *SPL*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | Adulto      |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |  0.04 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.081 | 0.074 |  0.07 | 0.077 | 0.075 |     0 |  0 | 0.132 | 0.143 | 0.151 | 0.157 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.053 | 0.064 | 0.061 | 0.072 |     0 |  0 | 0.189 | 0.173 | 0.197 | 0.191 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 | 0.022 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |  0.02 | 0.055 | 0.073 | 0.062 | 0.071 |     0 |  0 |  0.17 |  0.17 | 0.183 | 0.175 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 | 0.041 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.036 | 0.057 |  0.08 | 0.062 | 0.069 |     0 |  0 | 0.154 | 0.168 |  0.17 | 0.162 |     0 |  0 |     0 |  0 |    0 |     0 |
      | Juvenil     |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      | All seasons | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.128 | 0.137 | 0.157 | 0.131 |     0 |  0 | 0.055 | 0.109 | 0.164 |  0.12 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *GCR*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | Adulto      | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.205 |     0 | 0.795 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |  0.23 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |  0.42 | 0.221 | 0.129 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |  0.33 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.503 |     0 | 0.167 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 | 0.329 |     0 |     0 |     0 |     0 |     0 |     0 | 0.157 | 0.245 | 0.062 |  0.14 | 0.067 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | Juvenil     |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |  0.22 |     0 |  0.78 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 | 0.214 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.702 | 0.059 | 0.025 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 | 0.058 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.886 |     0 | 0.056 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 | 0.259 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.293 | 0.129 |  0.32 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *BRC*       | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | Adulto      | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.103 | 0.178 | 0.159 |   0.1 |     0 |  0 | 0.125 | 0.115 | 0.116 | 0.103 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.037 | 0.136 | 0.103 | 0.109 |     0 |  0 | 0.168 | 0.154 | 0.156 | 0.137 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.027 | 0.073 | 0.113 | 0.117 | 0.096 |     0 |  0 | 0.157 | 0.144 | 0.145 | 0.128 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |  0.05 | 0.104 | 0.094 |  0.13 | 0.084 |     0 |  0 | 0.147 | 0.135 | 0.136 |  0.12 |     0 |  0 |     0 |  0 |    0 |     0 |
      | Juvenil     |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      | All seasons | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.023 | 0.228 | 0.074 | 0.085 | 0.084 |     0 |  0 | 0.138 | 0.127 | 0.128 | 0.113 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *SPF*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | All seasons | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.229 |  0.01 | 0.201 |  0.21 |     0 |  0 | 0.085 | 0.164 |     0 | 0.101 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *SBF*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.047 |     0 | 0.166 |  0.12 | 0.162 | 0.174 |     0 |  0 | 0.056 | 0.095 |  0.11 |  0.07 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 | 0.036 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |   0.3 | 0.064 | 0.134 | 0.101 |     0 |  0 | 0.125 | 0.089 | 0.087 | 0.064 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.049 | 0.309 | 0.128 | 0.123 |     0 |  0 | 0.119 | 0.102 | 0.094 | 0.076 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.213 | 0.111 | 0.193 | 0.129 |     0 |  0 | 0.085 | 0.101 | 0.086 | 0.081 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *LBF*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.085 | 0.085 | 0.256 | 0.192 |     0 |  0 | 0.181 | 0.085 | 0.114 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.045 | 0.136 | 0.045 |     0 |     0 |  0 | 0.636 | 0.045 | 0.091 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.086 | 0.054 | 0.241 | 0.046 | 0.046 |  0 | 0.344 | 0.054 | 0.077 | 0.052 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.073 | 0.146 | 0.167 | 0.227 |     0 |  0 | 0.065 | 0.089 | 0.088 | 0.146 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *LPF*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 | 0.179 |  0 |  0 |     0 |     0 |     0 |     0 | 0.195 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.101 |     0 | 0.088 | 0.088 |     0 |  0 | 0.126 |  0.09 | 0.005 | 0.129 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |  0.13 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.181 | 0.014 |  0.14 | 0.137 |     0 |  0 |  0.15 | 0.181 | 0.066 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.174 | 0.047 | 0.128 | 0.074 |     0 |  0 | 0.252 | 0.268 | 0.058 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 | 0.078 |     0 | 0.114 | 0.118 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.119 | 0.022 | 0.093 | 0.113 |     0 |  0 | 0.112 | 0.098 | 0.105 | 0.027 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *OCT*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 | 0.067 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.114 | 0.137 | 0.103 | 0.186 |     0 |  0 | 0.157 | 0.077 |  0.09 | 0.067 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 | 0.064 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.117 | 0.116 | 0.112 | 0.096 |     0 |  0 | 0.107 | 0.192 | 0.099 | 0.096 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 | 0.033 |     0 |     0 | 0.099 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.131 | 0.111 |  0.14 | 0.084 |     0 |  0 | 0.104 | 0.132 | 0.084 | 0.082 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 | 0.203 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.146 | 0.106 | 0.169 | 0.071 |     0 |  0 | 0.102 | 0.068 | 0.068 | 0.068 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *SUR*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | All seasons | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 | 0.045 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.022 | 0.195 | 0.094 | 0.081 | 0.069 |     0 |  0 | 0.117 | 0.089 | 0.216 | 0.072 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *VID*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.044 | 0.088 | 0.044 | 0.264 |     0 |  0 | 0.165 | 0.044 | 0.308 | 0.044 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 | 0.047 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.106 | 0.083 |     0 | 0.481 |     0 |  0 | 0.142 | 0.094 | 0.047 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.199 | 0.241 |     0 | 0.144 |     0 |  0 | 0.207 | 0.169 |  0.04 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.315 | 0.512 |     0 |     0 |     0 |  0 | 0.085 | 0.088 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *SCR*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |  0.06 | 0.056 | 0.086 | 0.057 |     0 |  0 | 0.347 | 0.132 | 0.173 |  0.09 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 | 0.045 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 | 0.112 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.148 | 0.049 | 0.046 | 0.029 |     0 |  0 | 0.084 | 0.184 |  0.15 | 0.153 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |   0.1 | 0.063 | 0.073 | 0.045 |     0 |  0 | 0.176 | 0.196 |  0.14 | 0.208 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.225 | 0.053 | 0.072 | 0.043 |     0 |  0 | 0.197 | 0.139 | 0.084 | 0.185 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *MOL*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | All seasons | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 | 0.213 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.406 | 0.263 | 0.039 | 0.039 |     0 |  0 |     0 |     0 | 0.013 | 0.026 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *ANG*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | S1          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 | 0.145 |     0 | 0.023 | 0.043 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.014 | 0.034 | 0.019 | 0.041 |     0 |  0 | 0.123 | 0.184 | 0.176 | 0.198 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S2          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 | 0.039 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |  0.04 | 0.109 | 0.188 |     0 |     0 |  0 | 0.152 | 0.149 | 0.204 | 0.119 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S3          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.022 | 0.028 | 0.215 |     0 |     0 |  0 |  0.18 | 0.171 | 0.211 | 0.173 |     0 |  0 |     0 |  0 |    0 |     0 |
      | S4          | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 | 0.047 |     0 | 0.006 | 0.044 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.073 | 0.061 | 0.033 | 0.051 |     0 |  0 | 0.169 | 0.156 | 0.172 | 0.189 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *ORO*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | All seasons | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.111 | 0.159 | 0.306 | 0.073 | 0.073 | 0.073 | 0.073 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 | 0.04 | 0.091 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *ALF*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | All seasons | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |  0.01 |     0 | 0.346 | 0.119 | 0.119 | 0.119 | 0.119 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 | 0.169 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *CHO*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | All seasons | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.067 | 0.067 | 0.067 | 0.067 | 0.067 | 0.067 | 0.067 | 0.067 | 0.067 | 0.067 | 0.067 |     0 |  0 | 0.067 | 0.067 | 0.067 | 0.067 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *OTA*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | All seasons | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.002 |     0 | 0.091 | 0.412 |     0 |  0 |     0 |     0 |     0 | 0.495 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *CET*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | All seasons | 0 | 0.005 | 0 | 0 | 0 | 0.025 | 0 | 0 | 0 | 0 | 0.007 |  0 |  0 |  0 |  0 |  0 | 0.007 |  0 | 0.092 | 0.003 |  0 |  0 | 0.007 | 0.384 | 0.005 | 0.034 | 0.003 | 0.036 |     0 |     0 |     0 | 0.007 |     0 |     0 | 0.003 |     0 | 0.384 |     0 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *DOL*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | All seasons | 0 | 0.005 | 0 | 0 | 0 | 0.025 | 0 | 0 | 0 | 0 | 0.007 |  0 |  0 |  0 |  0 |  0 | 0.007 |  0 | 0.092 | 0.003 |  0 |  0 | 0.007 | 0.384 | 0.005 | 0.034 | 0.003 | 0.036 |     0 |     0 |     0 | 0.007 |     0 |     0 | 0.003 |     0 | 0.384 |     0 |     0 |     0 |  0 |     0 |     0 |     0 |     0 |     0 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | *BIR*       |   |       |   |   |   |       |   |   |   |   |       |    |    |    |    |    |       |    |       |       |    |    |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |       |    |       |       |       |       |       |    |       |    |      |       |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
      | All seasons | 0 |     0 | 0 | 0 | 0 |     0 | 0 | 0 | 0 | 0 |     0 |  0 |  0 |  0 |  0 |  0 |     0 |  0 |     0 |     0 |  0 |  0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 |     0 | 0.125 | 0.125 | 0.125 | 0.125 |     0 |  0 |     0 | 0.125 | 0.125 | 0.125 | 0.125 |  0 |     0 |  0 |    0 |     0 |
      |-------------+---+-------+---+---+---+-------+---+---+---+---+-------+----+----+----+----+----+-------+----+-------+-------+----+----+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+----+-------+-------+-------+-------+-------+----+-------+----+------+-------|
    - Some considerations
      - For lobster in winter distribution I use the mean between spring and autumm
      - For Large pelagic fish, Mollusca, Octupus, Small bentic fish and small crustacean, I use the average distribution for all the seasons.
***** Vertical distribution
- *Deph Distribution*
        | Functional Groups | Min |  Max | Author                                                              |
        |-------------------+-----+------+---------------------------------------------------------------------|
        | SPL               |   2 |  250 | Retamal & Arana 2000  - Descripcion y distribucion de 5 decapodos   |
        | GCR               | 100 | 1000 | Arana et al 2000  -  Pesca exploratoria                             |
        | BRC               |  20 |  300 | Arana & Vega 2000  -  Pesca exploratoria espinel and billy DB       |
        | ORO               | 500 | 1000 | Niklitschek 2007 evaluacion hidroacustica alfonsino y otange roughy |
        | ALF               | 200 |  600 | Niklitschek 2007 evaluacion hidroacustica alfonsino y otange roughy |
        | LPF               |   0 |  200 | Billy data base                                                     |
        | SPF               |   0 |  250 | Billy data base                                                     |
        | SBF               |   0 |  250 | Billy data base                                                     |
        | LBF               |   0 |  250 | Billy data base                                                     |
        | VID               |   3 |  150 | IUCN and fish-base                                                  |
        | ANG               |   0 |  300 | Arana 2000 - PEsca exploratoria con trampa                          |
        | CHO               |  20 |  600 | Fishbase                                                            |
        | COR               |  50 | 1000 | Data base &   Niklitschek 2010                                      |
        |                   |     |      |                                                                     |

- *Day-nigth distribution*
  - Vertebrates
    | FG      | JvAd     | Layer 8 | Layer 7 | Layer 6 | Layer 5 | Layer 4 | Layer 3 | Layer 2 | Layer 1 |
    |---------+----------+---------+---------+---------+---------+---------+---------+---------+---------|
    | Anguila | Both     |    1.00 |    0.00 |    0.00 |    0.00 |    0.00 |    0.00 |    0.00 |    0.00 |
    | BRC     | Adult    |    0.07 |    0.07 |    0.01 |    0.06 |    0.36 |    0.21 |    0.14 |    0.09 |
    | BRC     | Juvenile |    0.01 |    0.04 |    0.03 |    0.03 |    0.37 |    0.21 |    0.22 |    0.09 |
    | CHO     | Both     |    0.00 |    0.13 |    0.00 |    0.09 |    0.37 |    0.22 |    0.09 |    0.11 |
    | LBF     | Both     |    0.05 |    0.14 |    0.45 |    0.17 |    0.09 |    0.02 |    0.09 |    0.00 |
    | LPF     | Both     |    0.00 |    0.00 |    0.00 |    0.00 |    0.00 |    0.01 |    0.04 |    0.95 |
    | SBF     | Both     |    0.77 |    0.03 |    0.08 |    0.00 |    0.02 |    0.04 |    0.01 |    0.05 |
    | SPF     | Both     |    0.00 |    0.01 |    0.00 |    0.06 |    0.13 |    0.19 |    0.13 |    0.49 |
    | VID     | Both     |    0.00 |    0.00 |    0.00 |    0.01 |    0.12 |    0.07 |    0.10 |    0.70 |




       | FG  | JvAd  | Ligth |      Deepest |              |              |              |              |              |              |      Surface | Source         |
       |-----+-------+-------+--------------+--------------+--------------+--------------+--------------+--------------+--------------+--------------+----------------|
       | ANG | Both  | Both  |            1 |            0 |            0 |            0 |            0 |            0 |            0 |            0 | Billy Database |
       | BRC | Adult | Both  |  0.065894115 | 0.0665757782 | 0.0077255169 | 0.0645307885 | 0.3583276528 | 0.2094978414 | 0.1376959782 |  0.089752329 | Billy Database |
       | BRC | Juv   | Both  | 0.0084033613 |  0.037214886 | 0.0288115246 | 0.0336134454 | 0.3709483794 | 0.2088835534 | 0.2172869148 | 0.0948379352 | Billy Database |
       | LBF | Both  | Both  |            0 | 0.0535714286 |            0 | 0.1160714286 | 0.4553571429 | 0.2053571429 | 0.0982142857 | 0.0714285714 | Billy Database |
       | LPF | Both  | Both  |            0 |            0 |            0 | 0.0031051079 | 0.0009315324 | 0.0099363453 | 0.0353206024 |  0.950706412 | Billy Database |
       | SBF | Both  | Both  |  0.223316913 | 0.2561576355 | 0.1871921182 |  0.144499179 | 0.0870279146 | 0.0295566502 |  0.039408867 | 0.0328407225 | Billy Database |
       | SPF | Both  | Both  |            0 |            0 |            0 | 0.0684931507 |            0 | 0.0904109589 | 0.1246575342 | 0.7164383562 | Billy Database |
       | VID | Both  | Both  |            0 |            0 |            0 | 0.0051813472 | 0.1191709845 |  0.067357513 |  0.103626943 | 0.7046632124 | Billy Database |
       | ALF | Both  | Both  |  0.119487909 | 0.0871266003 | 0.1123755334 | 0.4327880512 | 0.1470483642 | 0.0460526316 | 0.0551209104 |            0 | Billy Database |
       | ORO | Both  | Both  | 0.4119850187 |  0.240948814 | 0.3121098627 | 0.0312109863 | 0.0037453184 |            0 |            0 |            0 | Billy Database |
       |     |       |       |              |              |              |              |              |              |              |              |                |
    #+CAPTION: Relative vertical Distribution of Vertebrates according to their maximimum and minimum depth
    #+ATTR_HTML: width="600" alt="image"
    [[/home/demiurgo/Documents/PhD/Functional_groups/Depth/relative_Functional_groups.png]]
    #+CAPTION: Relative vertical Distribution of Orange Roughy and Algonsino according to their maximimum and minimum depth
    #+ATTR_HTML: width="600" alt="image"
  [[/home/demiurgo/Documents/PhD/Functional_groups/Depth/alf_orang/relative_Industrial_groups.png]]
  @<br style="clear:both;" />

  - Invertebrates
         | FG  | Light | Deepest layer |              |              |              |              |              |              |      Surface | Source         |
         |-----+-------+---------------+--------------+--------------+--------------+--------------+--------------+--------------+--------------+----------------|
         | GCR | D     |             1 |            0 |            0 |            0 |            0 |            0 |            0 |            0 | Billy Database |
         | GCR | N     |             1 |            0 |            0 |            0 |            0 |            0 |            0 |            0 | Billy Database |
         | SPL | D     |             1 |            0 |            0 |            0 |            0 |            0 |            0 |            0 | Billy Database |
         | SPL | N     |             1 |            0 |            0 |            0 |            0 |            0 |            0 |            0 | Billy Database |
         | OCT | D     |           0.8 |          0.2 |            0 |            0 |            0 |            0 |            0 |            0 | Billy Database |
         | OCT | N     |           0.5 |          0.3 |          0.2 |            0 |            0 |            0 |            0 |            0 | Billy Database |
         | COP | D     |             0 |            0 |            0 | 0.0034546292 | 0.1273606633 | 0.3287655458 | 0.5404191617 |            0 | Antesana  2009 |
         | COP | N     |  0.0295087372 | 0.0602538741 | 0.0787174415 | 0.0787174415 | 0.0492087043 | 0.0049455984 | 0.0085723706 | 0.6900758325 | Antesana 2009  |
         | EUF | D     |             0 |  0.021312873 |  0.028417164 | 0.1449275362 | 0.0824097755 | 0.2750781472 | 0.2810457516 | 0.1668087525 | Hidalgo,2005   |
         | EUF | N     |             0 |            0 |            0 |            0 |            0 | 0.0044113875 | 0.2979738394 |  0.697614773 | Hidalgo, 2005  |
         | SUR | D     |             1 |            0 |            0 |            0 |            0 |            0 |            0 |            0 | Billy Database |
         | SUR | N     |             1 |            0 |            0 |            0 |            0 |            0 |            0 |            0 | Billy Database |
         | MOL | D     |             1 |            0 |            0 |            0 |            0 |            0 |            0 |            0 | Billy Database |
         | MOL | N     |             1 |            0 |            0 |            0 |            0 |            0 |            0 |            0 | Billy Database |

  #+CAPTION: Relative vertical Distribution of Medium (Copepods) and Large (Eufausiid) zooplancton according to their maximimum and minimum depth
  #+ATTR_HTML: width="600" alt="image"
  [[/home/demiurgo/Documents/PhD/Functional_groups/Depth/COP-EUF/copeuf.png]]
  @<br style="clear:both;" />
***** Speed movement
      | Functional group | Speed m.hr-1 | Specie or group | Real speed reported | Source                                  |
      |------------------+--------------+-----------------+---------------------+-----------------------------------------|
      | SPL              |         1260 | Lobster         | 35 cm*sec-1         | Childress and Jury. Chapter 3-behaviour |
      | GCR              |          450 | Gost crab       | 0.45 K*h            | Tully and andrus 2011                   |
      | BRC              |         2228 | Acanthuridae    | 61.9cm*s            | Fulton et al. 2005                      |
      | ORO              |         1440 | Trachinidae     | 0.4 m*s             | Fishbase                                |

- Look for the depth distribution of the functional groups
  For this, I use the information in SETas model and references
***** Migration
  - *Day of migration*
    | Species  | Month               | Reference       |
    |----------+---------------------+-----------------|
    | Vidriola | Spring-Summer       | Arana 2000b     |
    | Whales   | Leave during winter | Whales in Chile |
    | Birds    | Srping and summer   | OIKONOS         |

    - *Vidriola*
     - catch analisys to Estimate the months when the vidriola is leaving the JFRE
        #+BEGIN_SRC R
          ##libraries
          library(ggplot2)
          rblue   <- rgb(t(col2rgb("royalblue")), alpha = 100, maxColorValue = 255)
          #setwd("/home/demiurgo/Documents/PhD/Functional_groups/Migration/Vidriola/")
          vid.io            <- read.table('/home/demiurgo/Documents/PhD/Functional_groups/Migration/Vidriola/Vid_month.txt', sep = ' ', header = TRUE)
          s                 <- qplot(as.factor(Month), Weight, data = vid.io, geom=c("boxplot"), xlab = 'Month', ylab = 'Biomass (kg)')
          mean.month        <- with(vid.io, aggregate(Weight~as.factor(Month), FUN = mean))
          mean.month$Weight <- mean.month$Weight / sum(mean.month$Weight)
          png('img/migration_Vid.png', width = 1000, height = 1000)
          par(mar=c(5,4,4,5)+.1, cex = 1.4)
          boxplot(Weight ~ as.factor(Month), data = vid.io, col = 'royalblue', bty = 'n', outline = FALSE, xlab = 'Months', ylab = 'Catch (Number)', border = rblue,las = 1,
                  main = 'Vidriola Migration')
          par(new = TRUE)
          plot(as.numeric(mean.month[, 1]), mean.month[, 2], type = 'b', pch = 20, col = 2, axes = F, xlab = '', ylab = '', bty = 'n')
          axis(4, col = 2, las = 1)
          mtext("Proportion", side=4, line=3)
          dev.off()
       #+END_SRC
       #+CAPTION: Catch and abundance of vidriola during the months
       #+ATTR_HTML: width="600" alt="image"
       [[/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/MandM/img/migration_Vid.png]]
       @<br style="clear:both;" />

    -  *Initial condition (Abundance) for migrating species*
       - _Vidriola_
         I use the length converted catch curve to estimate Z.
          #+BEGIN_SRC R :results output HTML
            library(ascii)
            options(asciiType="org")
            ##-------------------------------------#
            ## Estimation of abundance using APV   #
            ##------------------------------------ #
            vid.io            <- read.table('/home/demiurgo/Documents/PhD/Functional_groups/Migration/Vidriola/Vid_month.txt', sep = ' ', header = TRUE)
            lfd               <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/Migration/Vidriola/VID.csv')
            sum.season        <- with(vid.io, aggregate(Weight~as.factor(Season), FUN = sum))
            dist              <- lfd$count/sum(lfd$count)
            mean.month        <- with(vid.io, aggregate(Weight~as.factor(Month), FUN = mean))
            mean.month$Weight <- mean.month$Weight / sum(mean.month$Weight)
            vec               <- c(t(outer(sum.season[8:10,2],mean.month[,2])))
            total             <- t(outer(vec, dist))
            dates             <- format(seq(as.Date('2013-01-30'), by='months',length.out=36), '%d/%m/%Y')
            colnames(total)   <- as.character(dates)
            total             <- cbind(id=lfd[,2],total)
            ## write.table(total, 'Vid_lccc.txt',row.names=FALSE,sep=',')
            ##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
            ##  Using length converted catch curve to estimate z  #
            ##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
            ## source('ElefanI.R')
            source('/home/demiurgo/Documents/PhD/Functional_groups/Migration/Vidriola/Lccc.R')
            ## ElefanI(data, vbplot = TRUE)
            data <- '/home/demiurgo/Documents/PhD/Functional_groups/Migration/Vidriola/Vid_lccc.txt'
            dat  <- Lccc(data, Linf = 964.95, K = 0.82, auto = TRUE, save = TRUE, quiet = TRUE)
            Z    <- dat$Z_Estimate[1]
            Z    <- 1.81 ## VAlue estimated using LCCC
            M    <- 0.2
            ## -  -  -  -  -  -  -  -  -  -  -  -  -  - #
            ## Last abundance  Using Baranov equation    #
            ## -  -  -  -  -  -   -  -  -  -  -  -  - - #
            abun.l <- data.frame(Season = c(2011 : 2015), Abundance = sum.season[6:10, 2] * Z) / ((Z - M) * (1 - exp( -  Z)))
            cap    <- "Reconstruction of the abundance by using the Baranov equation"
            b      <- ascii(abun.l, header = T, include.rownames = FALSE, include.colnames = T, caption=cap)
            print(b)

          #+END_SRC
          #+RESULTS:

	 #+CAPTION: Reconstruction of the abundance by using the Baranov equation
           |  Season | Abundance |
           |---------+-----------|
           | 1493.48 |   1477.29 |
           | 1494.23 |   2234.08 |
           | 1494.97 |   7038.28 |
           | 1495.71 |   6276.84 |
           | 1496.45 |   8334.10 |

         #+CAPTION: Estimation of Z using the length converted catch curve aproximation
         #+ATTR_HTML: width="600" alt="image"
          [[/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/MandM/img/lccc.png]]
         @<br style="clear:both;" />
       - _Whales_
           - Relative Abundance
           | Year         | Abundance index | Reference                               |
           |--------------+-----------------+-----------------------------------------|
           | 1997-1998    |            0.15 | Huke and Gaete 1998 (sensu Aguayo 1998) |
           | 1958         |           14.35 | Clarrke (1962)                          |
           | 1964         |            1.25 | Clarke (1998)                           |
           | 1994 - May   |            1.14 | Aguayo-lobo 1998                        |
           | 1995-sep     |           50.63 | Aguayo-lobo 1998                        |
           | 1995-Jun,jul |            1.89 | Aguayo-lobo 1998                        |
           | 1997         |            2.71 | Aguayo lobo 1998                        |
           | 1982         |               1 | Gallardo y Pastene                      |
           | 1994-May     |            0.13 | Aguallo-lobo 1998                       |
           | 1994-sept    |            0.25 | Aguallo-Lobo 1998                       |
           | 1995-sept    |            0.63 | Aguallo-Lobo 1998                       |
           |              |                 |                                         |
          - Abundance (N) - Information from the IWC (2016)
            | hemisphere | Sperm-whale | Humpback Whale | Blue Whale | Right Whale | Total |
            |------------+-------------+----------------+------------+-------------+-------|
            | South      |        1905 |             76 |         60 |          87 |  2128 |
            |            |             |                |            |             |       |
            #+TBLFM: $6=vsum(@2$2..@2$5)

           - Value using the maximun available number
            19105
       - _Dolphins_
         I use the double of whales
       - _Birds_
         The main seabird in the JFRE is the fardela
          *Oikonos tag information*   :  8601 individuals
    - Estimation of Reserve weight and structural weight
     * The convertion from normal weight need to be done in following steps (remember that the ratios can change,  this is a rule of thum)
     * Frist  : The weight need to be in mg (miligrams)
     * Second : pass from wet to dry weight
       - \( Weight(mg)_{dry}  = Weigth(mg)_{wet} / 20 \)
     * Third  : From dry weight to Nitrogen
       - \(N(mg) = Weight(mg)_{dry} / 5.7\)
     * Forth  : Conversion to Structural weight and Reserve weight
      The ratio between structural weigth and reserve weight is 1:2.65
     * _Vidriola_
        #+BEGIN_SRC R :results output HTML
          library(ascii)
          options(asciiType="org")
          ##-----------------------------------------------#
          ##     Estimation of Wl for Vidriola             #
          ##-----------------------------------------------#

          wl <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/Migration/Vidriola/Vid_WL.prn')
          ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
          ## ~                     Estimation of length weight relationship                 ~ ##
          ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
          WL.relationship <- function(alfa, beta, len){
              weight <- alfa * len ^ beta
              return(weight)
          }
          len.obs <- wl$Fork_len
          wei.obs <- wl$Weight
          res     <- nls(wei.obs ~ WL.relationship(alfa, beta, len.obs), start = c(alfa = 0.02, beta = 1.7))
          param   <- coefficients(res)
          av.size <- c(580.2, 667.4, 776.4)
          t.wei   <- WL.relationship(param[1],param[2], av.size)
          png('img/wl.vid.png', height=1000, width=1000)
          par(cex = 1.4)
          plot(len.obs, wei.obs,pch = 19, col = 'grey', bty = 'n', xlab = 'fork length (mm)', ylab = 'weight (g)')
          lines(len.obs,WL.relationship(param[1], param[2],len.obs),col = 2)
          points(av.size, t.wei, pch = 19)
           invisible(dev.off())

          ## Wet to dry conversion
          t.wei <- (t.wei / 20) * 1000 ## conversion from g to mg

          ## From dry weight to nitrogen
          t.wei <- t.wei / 5.7

          ##--------------------------------------------------------------------------
          ## Generaly the ratio between structural weight and reserve weight is 1:2.65
          ##  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -
          factor  <- t.wei / 3.65
          out     <- data.frame(structural = factor, reserve = factor * 2.65)

          cap <- "Structural and reserve weight for Vidriola"
          b   <- ascii(out, header = T, include.rownames = FALSE, include.colnames = T, caption=cap)
          print(b)
       #+END_SRC

         #+RESULTS:
       #+CAPTION: Structural and reserve weight for Vidriola
         | structural |  reserve |
         |------------+----------|
         |    5640.62 | 14947.64 |
         |    8513.40 | 22560.50 |
         |   13281.82 | 35196.83 |
       #+CAPTION: allometric relationship Vidriola
       #+ATTR_HTML: width="600" alt="image"
       [[/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/MandM/img/wl.vid.png]]
       @<br style="clear:both;" />

     * _Whales_
       | Average weight | Average (gr) | Specie                     | Common name | Source |
       |----------------+--------------+----------------------------+-------------+--------|
       | 1000 - 3000 kg |      2000000 | Globicephala macrorhynchus | Pilot Whale | NOAA   |
       | 13607 - 40823  |     27215000 | Physeter macrocephalus     | Sperm Whale | NOAA   |
       |----------------+--------------+----------------------------+-------------+--------|
       | Total Average  |     29215000 |                            |             |        |
	#+TBLFM: $2=vsum(@2$2..@3$2)::@4$2=vsum($2@2..$2@3)

	- Reserve weight and structural weight (1 : 2.65)
	  #+BEGIN_SRC R  :results output :exports both
            library(ascii)
            options(asciiType="org")
            t.wei <- 29215000
            t.wei <- (t.wei / 20) * 1000 ## conversion from g to mg

            ## From dry weight to nitrogen
            t.wei <- t.wei / 5.7

            ##--------------------------------------------------------------------------
            ## Generaly the ratio between structural weight and reserve weight is 1:2.65
            ##  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -
            factor  <- t.wei / 3.65
            out     <- data.frame(structural = factor, reserve = factor * 2.65)
            cap     <- 'Structural and reserve weight for Whales'
            b       <- ascii(out,header=T,  include.rownames = FALSE, include.colnames = T, caption=cap)
            print(b)
	  #+END_SRC
          #+RESULTS:
          #+CAPTION: Structural and reserve weight for Whales
          |  structural |      reserve |
          |-------------+--------------|
          | 70211487.62 | 186060442.20 |

     * _Dophin_
       | Average weight | Average (gr) | Specie             | Common name        | Source |
       |----------------+--------------+--------------------+--------------------+--------|
       | 300 - 635 kg   |       467500 | Tursiops truncatus | Bottlenose Dolphin | NOAA   |
        #+TBLFM: $2=avg(300, 635)
        #+BEGIN_SRC R  :results output
            library(ascii)
            options(asciiType="org")
            t.wei <- 467500
            t.wei <- (t.wei / 20) * 1000 ## conversion from g to mg

            ## From dry weight to nitrogen
            t.wei <- t.wei / 5.7

            ##--------------------------------------------------------------------------
            ## Generaly the ratio between structural weight and reserve weight is 1:2.65
            ##  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -
            factor  <- t.wei / 3.65
            out     <- data.frame(structural = factor, reserve = factor * 2.65)
            cap     <- 'Structural and reserve weight for Whales'
            b       <- ascii(out,header=T,  include.rownames = FALSE, include.colnames = T, caption=cap)
            print(b)
	  #+END_SRC

        #+RESULTS:
	#+CAPTION: Structural and reserve weight for Whales
         | structural |    reserve |
         |------------+------------|
         | 1123528.00 | 2977349.19 |

     * _Birds_
      |  Weight | Avera weight (gr) | Structural | Reserve | reference                                                     |
      |---------+-------------------+------------+---------+---------------------------------------------------------------|
      | 580-900 |               740 |     202.74 |  537.26 | http://www.oiseaux-birds.com/card-pink-footed-shearwater.html |

      #+BEGIN_SRC R  :results output
        library(ascii)
        options(asciiType="org")
        t.wei <- 740
        t.wei <- (t.wei / 20) * 1000 ## conversion from g to mg

        ## From dry weight to nitrogen
        t.wei <- t.wei / 5.7

        ##--------------------------------------------------------------------------
        ## Generaly the ratio between structural weight and reserve weight is 1:2.65
        ##  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -
        factor  <- t.wei / 3.65
        out     <- data.frame(structural = factor, reserve = factor * 2.65)
        cap     <- 'Structural and reserve weight for Birds'
        b       <- ascii(out,header=T,  include.rownames = FALSE, include.colnames = T, caption=cap)
        print(b)
      #+END_SRC
      #+RESULTS:
      #+CAPTION: Structural and reserve weight for Birds
         | structural | reserve |
         |------------+---------|
         |    1778.42 | 4712.81 |

**** Spatial Cover
- For the Cover, I used the data for friedman and also I ude data from YaÃ±ez et al.
#+BEGIN_SRC R
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  ## ~              Total Sediment Cover By Box           ~ ##
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  ## Estimation of the total cover by area
  source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/General_tools/Atlantis_tools.R')

  # data
  lc   <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/location/Location_species.csv')
  poly <- read.poly('/home/demiurgo/Documents/PhD/Polygonos/Map/Polygons_27042016.csv')
  ##~ FUNCTIONAL GROUPS
  lc <- FG(data = lc, column = 2)
  ##~ Weight
  lc <- WtoN(lc, 6, 9, 7)
  ## By season
  lc$season.vat <- with(lc,  ifelse(month %in% c(1,2,3),   1,
                             ifelse(month %in% c(4, 5, 6), 2,
                             ifelse(month %in% c(7,8,9),   3, 4))))
  ## by Groups
  lc.FG    <- split(lc, lc$FG)
  names(lc.FG)
  ## poly
  lon <- as.matrix(poly$coor[, c(seq(from = 1, to = dim(poly$coor)[2], by = 2))])
  lat <- as.matrix(poly$coor[, c(seq(from = 2, to = dim(poly$coor)[2], by = 2))])
  names(lc.FG[[11]])
  poly <- by.pol(poly, lc.FG, la = 5, lo = 4, sea = 11, mult = 10)

  ## Only sumer sampling
  loc      <- which(colnames(poly[[1]]$attrib) %in% c("COR", "ROC", "MA", "SAN", "BFF", "BCA"))
  sed.type <- poly[[1]]$attrib[, loc] - 1
  sed.prop <- sed.type / rowSums(sed.type, na.rm = T)
  sed.prop[which(is.na(sed.prop), arr.ind = TRUE)] <- 0
  ord      <- order(poly[[1]]$attrib[, 1])
  ## this need to be polished
  out      <- data.frame(box =  poly[[1]]$attrib[ord, 1], sed.prop[ord, ])
  write.table(out, '/home/demiurgo/Documents/PhD/Functional_groups/location/Type.sed.csv', row.names = FALSE)
 #+END_SRC
**** Throphic relation
***** Availability matrix
  - I will leave this one for the last part
  - Gape size
    I wil use the normal limits (0.1% to 40%)
  - I increase the value of KLP to 1e-06 for whales
***** Estimation of structural weight to calculate the biomass for predation
  #+BEGIN_SRC R :results output
    source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/Atlantis_tools.R')
    library(ascii)
    options(asciiType="org")
    data  <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/Structural_weight/SN.csv')
    out   <- with(data, weights(FG, weight, metric = 'g'))
    cap   <- 'Structural and reserve weight for all the biomass GF'
    b     <- ascii(out,header=T,  include.rownames = FALSE, include.colnames = T, caption=cap)
    print(b)
  #+END_SRC
  #+RESULTS:
  #+CAPTION: Structural and reserve weight for all the biomass GF
     | Functional_Groups |  structural |      reserve |
     |-------------------+-------------+--------------|
     | CHO               |    11103.10 |     29423.22 |
     | OTA               |   225907.23 |    598654.17 |
     | CET               | 70211487.62 | 186060442.20 |
     | BIR               |     1778.42 |      4712.81 |
     | OCT               |     1737.56 |      4604.54 |
     | SCR               |     1485.22 |      3935.83 |
     | BFF               |      240.33 |       636.87 |
     | SUR               |      456.44 |      1209.57 |
     | MOL               |      672.92 |      1783.23 |
     | DOL               |  1123528.00 |   2977349.19 |

***** Estimation of Clearance
  I use the length of the individual and the speed of each one,  there is another aproximation but I need to have the production and the number of preys. In this aproximation,  I asume that the clearence rate is equal to the time and the speed looking for food
  #+BEGIN_SRC R :results output
    library(ascii)
    library(ggplot2)
    source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/Atlantis_tools.R')
    options(asciiType = "org")
    data <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/Clearance/c_data.csv')
    ## swimming speed
    ## from mm to  meters
    data$length <- data$length  / 1000
    cap         <- 'Clearance by cohort for some functional groups [m3d-1]'
    C.out       <- clearance(fg     = data[, 1],
                             speed  = data[, 3],
                             len    = data[, 2],
                             ratio  = data[, 4],
                             time.l = data[, 5])
    p.C <- C.out[-c(4, 5, 9), ]
    p.C   <- na.omit(data.frame(FG= rownames(p.C), Cohort = sort(rep(1 : 10, nrow(p.C))), Clearance = c(p.C)))

    png('img/clearance.png', height = 1000, width = 1000)
    sp    <- ggplot(data=p.C, aes(Cohort, Clearance))+ geom_line()
    sp + facet_wrap(~FG, ncol = 4, scales = 'free_y')
    invisible(dev.off())
    b     <- ascii(C.out,header=T,  include.rownames = TRUE, include.colnames = TRUE, caption=cap)
    print(b)
  #+END_SRC
  #+RESULTS:
  #+CAPTION: Clearance by cohort for some functional groups [m3d-1]
   |     |       1 |       2 |       3 |       4 |       5 |       6 |       7 |       8 |       9 |      10 |
   |-----+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------|
   | ALF |    2.36 |    9.26 |   18.09 |   28.70 |   40.15 |   51.71 |   62.85 |   73.22 |   82.70 |   91.10 |
   | ANG |    0.60 |   72.60 |  344.13 |  837.05 | 1514.40 | 2320.14 | 3198.52 | 4102.24 | 4994.94 | 5850.78 |
   | BIR |    0.38 |    1.24 |    2.33 |    3.47 |    4.57 |    5.58 |    6.49 |    7.28 |    7.96 |    8.55 |
   | BRC |   20.91 |   29.75 |   40.15 |   51.72 |   65.09 |   81.46 |   99.99 |  115.88 |  131.25 |  147.57 |
   | CET | 3111.88 | 3599.63 | 3851.93 | 3978.84 | 4041.87 | 4072.98 | 4088.28 | 4095.80 | 4099.50 | 4101.31 |
   | CHO |    5.10 |   16.28 |   29.51 |   42.66 |   54.70 |   65.23 |   74.16 |   81.58 |   87.67 |   92.62 |
   | DOL |   13.39 |   43.88 |   81.51 |  120.50 |  157.67 |  191.46 |  221.26 |  246.99 |  268.89 |  287.32 |
   | GCR |    0.03 |    0.10 |    0.22 |    0.37 |    0.55 |    0.73 |    0.90 |    1.04 |    1.19 |    1.32 |
   | LBF |  178.39 |  244.89 |  340.76 |  424.55 |  534.44 |  730.52 |  908.95 | 1029.94 | 1223.99 | 1446.00 |
   | LPF |    8.85 |  165.77 |  367.12 |  506.61 |  585.71 |  627.02 |  647.81 |  658.09 |  663.14 |  665.60 |
   | OCT |  480.00 |         |         |         |         |         |         |         |         |         |
   | ORO |    0.02 |    4.04 |   13.37 |   22.90 |   30.31 |   35.44 |   38.76 |   40.85 |   42.12 |   42.88 |
   | OTA |  350.36 |  483.53 |  598.37 |  693.28 |  769.64 |  830.00 |  877.13 |  913.62 |  941.69 |  963.18 |
   | SBF |    7.06 |   12.90 |   21.29 |   35.90 |   55.23 |   87.47 |  110.62 |  174.41 |  220.49 |  274.03 |
   | SPF |    0.31 |    8.53 |   26.92 |   49.12 |   70.26 |   88.13 |  102.25 |  112.94 |  120.82 |  126.54 |
   | SPL |    0.90 |    1.07 |    1.27 |    1.48 |    1.74 |    1.97 |    2.20 |    2.40 |    2.61 |    2.84 |
   | VID |  438.65 |  667.79 | 1051.19 |         |         |         |         |         |         |         |
   #+ATTR_HTML: width="600" alt="image"
   [[/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/MandM/img/clearance.png]]
   @<br style="clear:both;" />
***** Estimation of growth rate
  - First, I estimated the value of the alfa and beta parameters from the allometric relationship
    #+BEGIN_SRC R :results output
      ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
      ## ~                   estimation length weight relationship                ~ ##
      ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
      library(ascii)
      options(asciiType="org")
      source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/Atlantis_tools.R')
      spgrey <- rgb(t(col2rgb("black")), alpha=30, maxColorValue=255)
      ## read the data
      dat    <- read.csv("/home/demiurgo/Documents/PhD/Functional_groups/length_weight/length_weight_jf.csv")
      ## Grupos funcionales
      lf          <- FG(dat, 2)
      ##from mm to cm
      lf[, 3 : 4] <- lf[, 3 : 4] / 10
      ##-----------
      ##  Divide by functional group
      ##---------------
      lf.fg       <- split(lf, lf$FG)  # split by functional group

      ## type of length that I used in the estimation of the cohorts for each functional group
      len.ty <- c('total', 'fork', 'total', 'fork', 'total', 'total', 'fork', 'total', 'total','total', 'total', 'total')

      alometric <- function(length, alfa, beta){
          weight <- alfa  * length ^ beta
          return(weight)
      }

      ## Removing octopus
      lf.fg <- lf.fg[ - 8]
      png('img/allometric.png', width = 1200, height = 900)
      res <- list()
      par(mfrow=c(3, 4), mar = c(4, 2, 1, 2), oma=c(3, 2, 0, 2), cex = 1.2)
      for(i in 1:length(lf.fg)){
          len       <- lf.fg[[i]][, ifelse(len.ty[i] == 'total', 4, 3)]
          weight    <- lf.fg[[i]][, 5]
          ## orden the list,  jut for plotting
          or        <- order(len)
          len       <- len[or]
          weight    <- weight[or]
          res[[i]]  <- nls(weight~alometric(len, alfa, beta), start = c(alfa = 0.5, beta = 1.4),
                           trace = FALSE, control = nls.control(maxiter = 5000, minFactor = 1/100000))
          plot(len, weight, col = spgrey, pch = 20, bty = 'n', xlab = '', ylab = '', main = lf.fg[[i]]$FG[1] )
          lines(len[!is.na(len)], predict(res[[i]]), col = 2)
          if( i == 1){
              parameters <- coef(res[[i]])
          } else {
              parameters <- cbind(parameters, coef(res[[i]]))
          }
      }
      mtext(text="Weight (gr)",side=2,outer=TRUE,font=2,cex=1.5)
      mtext(text="Length (mm)",side=1,outer=TRUE,font=2,cex=1.5)
      invisible(dev.off())

      ## table with parameters
      cap                  <- 'Values of the paramter alfa and beta in the allometric relationship for each functional group'
      colnames(parameters) <- names(lf.fg)
      b                    <- ascii(parameters, header=T,  include.rownames = TRUE, include.colnames = T, caption = cap, digit = 8)
      print(b)
    #+END_SRC
    #+RESULTS:
    #+CAPTION: Values of the paramter alfa and beta in the allometric relationship for each functional group
    |      |    Anguila |      Breca |            CHO | Golden Crab | Large benthic fish | Large pelagic fish |    Lobster |        OTA | Small benthic fish | Small pelagic fish |   Vidriola |
    |------+------------+------------+----------------+-------------+--------------------+--------------------+------------+------------+--------------------+--------------------+------------|
    | alfa | 0.00470168 | 0.00839310 | 21162.92055755 |  0.53179259 |         0.00026108 |         0.02835469 | 0.96225457 | 3.88353881 |         7.07514256 |         0.00716116 | 0.00523585 |
    | beta | 2.83452053 | 3.14636532 |    -0.38586474 |  2.84013419 |         3.87985815 |         2.73409475 | 2.71901358 | 2.07274350 |         1.37204560 |         3.14316080 | 3.10821550 |

    #+CAPTION: Allometric relationship for different functional groups
    #+ATTR_HTML: width="600" alt="image"
    [[/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/MandM/img/allometric.png]]

  - For Seals I use the values from Amano2000
    - \( W = 71.6(1 - 0.323 * exp( - 0.248 * t))^3 \)
  - Calculation of mum
    #+BEGIN_SRC R  :results output
      ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
      ## ~         Estimation of mum      ~ ##
      ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
      data  <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/mum/mum.csv')
      library(ascii)
      library(ggplot2)
      options(asciiType="org")
      source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/Atlantis_tools.R')
      ## estimation of the weight at each age class or cohort
      data$Weight <- ifelse(is.na(data$Weight), alometric(data$Length, data$alfa, data$beta), data$Weight)
      fg          <- split(data, data$FG)
      spw.rate    <- 1.2
      res         <- list()
      for( i in 1: length(fg)) {
          res[[i]] <- with(fg[[i]], mum.f(length     = Length,   # Length in cm
                                          weight     = Weight,   # Weight
                                          metric     = 'g',      # metric for weight grams
                                          spw.rate   = 1.4,      # I asume that 40% of the reserve weight in going to reproduction
                                          mature     = Mature,   # Age at maturity
                                          AgeClass   = AgeClass))# Number year for earch Age class
      }

      ## Arrangement for the output
      m   <- as.vector(table(data[, 1]))
      out <- matrix(NA, nrow = max(m), ncol = length(m))
      dat <- array()
      for(i in 1 : length(res)){
          out[, i] <- c(res[[i]], rep(NA, 10 - length(res[[i]])))
          if(length(res[[i]]) > 1){
              dat <- rbind(dat, cbind(rep(names(fg)[i], length(res[[i]])),res[[i]], seq(1 : length(res[[i]]))))
          }
      }

      dat           <- data.frame(FG = dat[-1, 1], Mum = as.numeric(dat[-1, 2]), Age = as.numeric(dat[-1, 3]))
      out           <- t(out)
      rownames(out) <- names(fg)
      colnames(out) <- c(1 : (ncol(out)))
      sp            <- ggplot(data=dat, aes(Age, Mum))+ geom_line()
      png('img/mum.png', height = 1200, width = 1200)
      sp + facet_wrap(~FG, ncol=4, scales = 'free_y')
      invisible(dev.off())
      ## table with parameters
      cap                  <- 'Values of growth rate (mum) for each functional group [mgN-1d-1]'
      b                    <- ascii(out, header=T,  include.rownames = TRUE, include.colnames = T, caption = cap)
      cat("#+ATTR_HTML: :style float:left;width:30%;margin:3ex\n")
      print(b)
    #+END_SRC

    #+RESULTS:
    #+ATTR_HTML: :style float:left;width:30%;margin:3ex
    #+CAPTION: Values of growth rate (mum) for each functional group [mgN-1d-1]
      |     |     1 |      2 |       3 |       4 |       5 |        6 |        7 |        8 |        9 |        10 |
      |-----+-------+--------+---------+---------+---------+----------+----------+----------+----------+-----------|
      | ALF |  0.08 |   0.34 |    1.06 |    1.71 |    2.52 |     3.51 |     4.71 |     6.17 |     7.90 |     10.06 |
      | ANG |  0.00 |   0.01 |    0.08 |    0.18 |    0.32 |     0.49 |     0.71 |     0.97 |     1.28 |      1.65 |
      | BCA |  0.46 |        |         |         |         |          |          |          |          |           |
      | BFF |  0.06 |        |         |         |         |          |          |          |          |           |
      | BIR |  0.02 |   0.21 |    0.54 |    1.01 |    1.62 |     2.39 |     3.33 |     4.49 |     5.90 |      7.63 |
      | BRC |  0.05 |   0.18 |    0.52 |    0.75 |    1.01 |     1.31 |     1.72 |     2.48 |     3.18 |      3.76 |
      | CET | 73.65 | 238.04 | 1359.33 | 2620.55 | 5172.94 | 10365.79 | 20944.64 | 42502.78 | 86438.54 | 175981.86 |
      | CHO |  0.02 |   0.11 |    0.42 |    0.80 |    1.29 |     1.93 |     2.73 |     3.73 |     5.00 |      6.60 |
      | DOL |  0.06 |   0.52 |    1.33 |    2.48 |    3.97 |     5.84 |     8.17 |    11.03 |    14.54 |     18.86 |
      | GCR |  0.01 |   0.06 |    0.21 |    0.41 |    0.68 |     1.04 |     1.54 |     2.24 |     2.65 |      3.47 |
      | LBF |  0.12 |   0.56 |    0.76 |    2.58 |    3.12 |     3.50 |     5.37 |     8.86 |     8.34 |     10.02 |
      | LPF |  0.02 |   0.19 |    0.56 |    1.10 |    2.06 |     3.96 |     7.83 |    15.74 |    31.99 |     65.37 |
      | MOL |  0.68 |        |         |         |         |          |          |          |          |           |
      | OCT |  0.35 |        |         |         |         |          |          |          |          |           |
      | ORO |  0.00 |   0.04 |    0.14 |    0.24 |    0.83 |     1.36 |     2.22 |     3.63 |     6.04 |     10.03 |
      | OTA |  2.28 |   6.75 |   21.07 |   28.82 |   38.57 |    51.14 |    67.58 |    89.22 |   117.81 |    155.60 |
      | SBF |  0.18 |   0.26 |    0.82 |    0.85 |    1.01 |     1.03 |     1.70 |     1.12 |     1.85 |      2.02 |
      | SCR |  1.26 |        |         |         |         |          |          |          |          |           |
      | SPF |  0.01 |   0.11 |    0.58 |    1.23 |    2.11 |     3.29 |     4.91 |     7.16 |    10.34 |     14.86 |
      | SPL |  0.13 |   0.37 |    1.29 |    1.56 |    1.72 |     2.36 |     2.75 |     3.51 |     3.91 |      4.33 |
      | VID |  0.24 |   1.85 |    2.43 |         |         |          |          |          |          |           |
    # #+name: fig.mum
    #+ATTR_HTML: width="600" alt="image"
    #+caption: Values of Growth rate for each Vertebrate Functional Group
    [[file:img/mum.png]]

***** Maturity and Spawning
      #+CAPTION: length (in mm) for the reproductive maturity for vertebraes and mobile bentos (with age classes)
    | FG  | Maturity | Age (y) | Reference                      | Specie                                            |
    |-----+----------+---------+--------------------------------+---------------------------------------------------|
    | SPL |     73.2 |       6 | Ernst 2013                     |                                                   |
    | GCR |    10.62 |       6 | Ernst 2013 & Canales 2009      |                                                   |
    | BRC |     28.9 |       5 | Rivara 2013  & Hernandez 2012  |                                                   |
    | VID |       51 |         | Fishbase                       | Seriola lalandi                                   |
    | ORO |       35 |      33 | Niklischek 2005                |                                                   |
    | ALF |     33.2 |       6 | Wiff 2013 \                    |                                                   |
    | SPF |       27 |         | Fishbase                       | Neoscorpis lithophilus                            |
    | LBF |       92 |      12 | Flores & Rojas 1985 & Fishbase |                                                   |
    | ANG |     43.7 |       2 | Fishbase                       |                                                   |
    | CHO |     77.8 |         | Fishbase                       | Squalus mitsukurii                                |
    | OTA |      105 |       5 | Amano2000 and Osman            |                                                   |
    | LPF |     34.5 |       3 | Fishbase (average)             | Pseudocaranx dentex                               |
    | SBF |       21 |         | Fishbase  + Munoz              | Helicolemus dactylipterus  + Girella tricuspidata |
    |     |          |         |                                |                                                   |

    #+CAPTION: Age of the behavioral maturity for vertebrates and mobile benthos. The age correspond to the cohort
    | Functional Group | Maturity | Reference           | Specie                                            |
    |------------------+----------+---------------------+---------------------------------------------------|
    | SPL              |        3 | Ernst 2013          |                                                   |
    | GCR              |        2 | Ernst 2013          |                                                   |
    | BRC              |        3 | Rivara 2013         |                                                   |
    | VID              |        1 | Fishbase            | Seriola lalandi                                   |
    | ORO              |        5 | Niklischek 2005     |                                                   |
    | ALF              |        3 | Wiff 2013           |                                                   |
    | SPF              |        3 | Fishbase            | Neoscorpis lithophilus                            |
    | LBF              |        4 | Flores & Rojas 1985 |                                                   |
    | ANG              |        3 | Fishbase            |                                                   |
    | OTA              |        3 | Amano2000 and Osman |                                                   |
    | LPF              |        2 | Fishbase (average)  | Pseudocaranx dentex                               |
    | SBF              |        3 | Fishbase  + Munoz   | Helicolemus dactylipterus  + Girella tricuspidata |



  - Estimation of KSPA_XXX and FSP_XXX
    The approach if dereved from the growth function :
    - \(Nr_{S, R} = p_{r}(W_{S} - cr / pr) - min{0, W(s) - (S + R)}\)
    - \(cr / pr = Nm\) ## weight just before the maturity age
    - \(pr = {alfa * Nt}/{(1 + alfa) * Nt - Nm}\)
    - \(cr = Nm*pr\)
    - pr = FSP_XXX & cr = KASP_XXX
    #+BEGIN_SRC R  :results output
      ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
      ## ~                 Estimation of KSPA_XX and FSP_XXX              ~ ##
      ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
      library(ascii)
      options(asciiType = "org")
      source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/Atlantis_tools.R')
      ##read the data
      data             <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/Mature_Growth/Mgrowth.csv')
      ## getting the weight before reproduction and the weith in equilibrium for all the FG
      data$Weight      <- ifelse(is.na(data$Weight), alometric(data$Length, data$Alfa, data$Beta), data$Weight)
      data$Weight_equi <- ifelse(is.na(data$Weight_equi), alometric(data$Length2, data$Alfa, data$Beta), data$Weight_equi)
      ## The weith in mgN for
      ##~~~ cr/pr == Nm
      data$Nm <- weight2N(weight = data$Weight, metric = 'g')
      ##~~~ Nt = Wigth at equilibrium
      data$Nt <- weight2N(weight = data$Weight_equi, metric = 'g')
      ## Getting KSPA_XXX and FSP_XXX
      rate       <- 0.4  # 20% of increase weight durint reproduction
      data$FSP   <- with(data, (rate * Nt)/((1 + rate) * Nt - Nm))
      data$KSPA  <- with(data, Nm * FSP)
      cap        <- 'Values of KASP and FSP for each functional group'
      ## table with parameters
      cap                  <- 'Values of KSPA_XX and FSP_XXX for each functional group'
      b                    <- ascii(data, header=T,  include.rownames = FALSE, include.colnames = T, caption = cap)
      print(b)
    #+END_SRC

    #+RESULTS:
    #+CAPTION: Values of KSPA_XX and FSP_XXX for each functional group
     | FG  |  FSP |     KSPA | Length | Length2 |   Weight | Weight_equi | Alfa | Beta |        Nm |        Nt |
     |-----+------+----------+--------+---------+----------+-------------+------+------+-----------+-----------|
     | ALF | 0.31 |   939.02 |  25.58 |   54.82 |   473.65 |     4117.29 | 0.05 | 2.84 |   3016.50 |  26221.61 |
     | ANG | 0.29 |   137.78 |  30.37 |  131.18 |    74.86 |     4735.54 | 0.00 | 2.83 |    476.77 |  30159.05 |
     | BRC | 0.31 |   364.60 |  24.07 |   50.56 |   186.52 |     1926.81 | 0.01 | 3.15 |   1187.86 |  12271.21 |
     | GCR | 0.29 |    56.18 |   4.15 |   14.75 |    30.27 |     1109.86 | 0.53 | 2.84 |    192.81 |   7068.33 |
     | LBF | 0.32 |  4638.99 |  62.70 |  101.51 |  2275.31 |    15114.86 | 0.00 | 3.93 |  14490.65 |  96261.41 |
     | LPF | 0.29 |   117.17 |  16.80 |   70.83 |    63.50 |     3245.49 | 0.03 | 2.73 |    404.38 |  20669.46 |
     | ORO | 0.47 |  6915.95 |  41.91 |   51.66 |  2323.06 |     4267.89 | 0.04 | 2.91 |  14794.76 |  27180.73 |
     | OTA | 0.37 | 74926.06 |  80.73 |         | 31597.16 |    97011.42 |      |      | 201231.61 | 617832.86 |
     | SBF | 0.31 |   411.93 |  22.01 |   60.96 |   208.39 |     1872.61 | 0.27 | 2.16 |   1327.17 |  11926.00 |
     | SPF | 0.32 |   331.33 |  19.66 |   48.30 |   163.35 |     1133.63 | 0.27 | 2.16 |   1040.29 |   7219.68 |
     | SPL | 0.35 |   609.71 |   7.96 |   12.94 |   271.18 |     1015.74 | 0.96 | 2.72 |   1727.03 |   6468.90 |
     | VID | 0.40 |  4059.30 |  58.02 |   77.64 |  1586.56 |     3923.89 | 0.01 | 3.11 |  10104.27 |  24989.94 |

**** Spawning
     #+CAPTION: First day of each month
    | Jun | Feb | Mar | Apr | May | Jun | Jul | Aug | Sep | Oct | Nov | Dec |
    |-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----|
    |   0 |  30 |  61 |  91 | 122 | 152 | 183 | 213 | 243 | 274 | 304 | 335 |

    #+CAPTION: Reproduction parameters for vertebrates functional groups
     | Functional Groups | Spawn date | Spawn period | Rec. time | Rec. Period | Comment            | Referece                              |
     |-------------------+------------+--------------+-----------+-------------+--------------------+---------------------------------------|
     | SPL               |        274 |          121 |       365 |          30 |                    | Data base & Porobic 2012              |
     | GCR               |        274 |          121 |        91 |          10 |                    | Data base   & Shanks 2009            |
     | BRC               |        122 |           61 |       243 |          10 |                    | Hernandez2012                         |
     | VID*              |        335 |           61 |       122 |          30 |                    | Moran et al 2007                      |
     | ORO               |        183 |           20 |       150 |          30 |                    | Paya 2003  & Mace 1990  & SETAS model |
     | ALF               |          1 |           61 |        91 |          30 |                    | TASCHERI 2004  & Mundy 1990          |
     | ANG               | 167  & 304 |           30 |       300 |          61 | 2 spawning periods | Lucano-Ramirez 2008  & Miller 2009   |
     | CHO               |         91 |           10 |       600 |          30 | Gestation 2 years  | Fishbase                              |
     | OTA               |        335 |           13 |       335 |          10 | Gestation 11 month | Osman 2007                            |
     | CET*              |        213 |           30 |       335 |          30 | Gestation 1 year   |                                       |
     | DOL*              |        213 |           30 |       335 |          30 | Gestation 1 year   |                                       |
     | BIR               |         20 |           30 |        90 |          30 |                    | Azocar,  2013                         |
     | OCT               |         91 |           61 |       150 |          30 |                    | Arancibia 2005 &  Uriarte 2012        |
     | LPF               |          1 |           61 |        30 |          30 |                    | Masuda 1999 & Fishbase                |
     | SPF               |        213 |           60 |        30 |          30 |                    | Fishbase                              |
     | SBF               |        213 |           61 |        30 |          40 |                    | Fishbase                              |
     | LBF               |        213 |           61 |        30 |          60 |                    | Fishbase                              |

**** Recruitment
***** Connectivity Simulations
****** Setting icthyops
******* I need to work on the SBF and LBF

     | FG  | Spawning date | PLD | Settlement_minimum | Source | Sink |
     |-----+---------------+-----+--------------------+--------+------|
     | SPL |           274 | 365 |                183 |        |      |
     | ORO |           183 | 200 |                100 |        |      |
     | BRC |           122 | 365 |                100 |        |      |
     | ALF |             1 | 150 |                 60 |        |      |
     | ANG |           304 | 450 |                150 |        |      |
     |     |               |     |                    |        |      |
****** Icthyops input files
#+BEGIN_SRC R
  source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/Atlantis_tools.R')
  source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/Cnect.tools.R')

  ## General Settings
  ## -  -  -  -  -  -  -
  n.poly <- c('Poly_0', 'Poly_1', 'Poly_2', 'Poly_3', 'Poly_4', 'Poly_5', 'Poly_6', 'Poly_7', 'Poly_8', 'Poly_9', 'Poly_10',
              'Poly_11', 'Poly_12', 'Poly_13', 'Poly_14', 'Poly_15', 'Poly_16', 'Poly_17', 'Poly_18', 'Poly_19', 'Poly_20',
              'Poly_21', 'AS_S_out', 'AS_N_out', 'JF5_N_out', 'RCSC_N_out', 'RCSC_S_out', 'JF5_S_out', 'JF4', 'JF3', 'JF2',
              'JF1_E', 'JF1_M', 'JF1_NO', 'JF1_SO', 'RCSC_NE', 'RCSC_SE', 'RCSC_NO', 'RCSC_SO', 'JF6_S', 'JF6_N', 'AS_NE',
              'AS_SE', 'AS_NO', 'AS_SO', 'RCSC', 'JF5', 'JF6', 'AS', 'BO2', 'BO1')

  map       <- '/home/demiurgo/Documents/PhD/Polygonos/Map/Polygons_27042016.csv'
  polygons  <- read.poly(map)
  or.pol    <- order(polygons$attrib$box_id)
  lon       <- as.matrix(polygons$coor[, c(seq(from = 1, to = dim(polygons$coor)[2], by = 2))])[or.pol, ]
  lat       <- as.matrix(polygons$coor[, c(seq(from = 2, to = dim(polygons$coor)[2], by = 2))])[or.pol, ]
  s.folder  <- '/home/demiurgo/Documents/PhD/Recruitment/cfg/'

  ## SPL
  ## -  -  -  -  -  -  -  -  -  -
  rel.pol     <- c(35, 36, 37, 38, 41, 42, 43, 44)
  rel.depth   <- c(100, 200)
  rec.pol     <- c(rel.pol, 22, 23, 25, 26)
  rec.depth   <- c(0, 300)
  zones.xml(lon = lon, lat = lat, rel.pol = rel.pol, rec.pol = rec.pol,
            rel.depth = rel.depth, pol.names = n.poly, name.file = paste(s.folder, 'SPL', sep = ''))

  ## GCR
  ## -  -  -  -  -  -  -  -  -  -
  rel.pol     <- c(25, 26, 33, 34, 35, 36, 37, 38)
  rel.depth   <- c(200, 600)
  rec.pol     <- c(rel.pol, 41, 42, 43, 44, 22, 23)
  rec.depth   <- c(0, 1200)
  zones.xml(lon = lon, lat = lat, rel.pol = rel.pol, rec.pol = rec.pol,
            rel.depth = rel.depth, pol.names = n.poly,  name.file = paste(s.folder, 'GCR', sep = ''))

  ## BRC
  ## -  -  -  -  -  -  -  -  -  -
  rel.pol     <- c(25, 26, 33, 34, 35, 36, 37, 38, 41, 42, 43, 44, 22, 23)
  rel.depth   <- c(0, 200)
  rec.depth   <- c(0, 300)
  zones.xml(lon = lon, lat = lat, rel.pol = rel.pol, rec.depth = rec.depth,
            rel.depth = rel.depth, pol.names = n.poly,  name.file = paste(s.folder, 'BRC', sep = ''))

  ## ORO
  ## -  -  -  -  -  -  -  -  -  -
  rel.pol     <- c(28, 29, 30, 31, 32, 33, 34, 49, 50)
  rel.depth   <- c(500, 1000)
  rec.pol     <- c(rel.pol, 22, 23, 39, 40, 47, 46, 25, 26)
  rec.depth   <- c(0, 1500)
  zones.xml(lon = lon, lat = lat, rel.pol = rel.pol, rec.pol = rec.pol,
            rel.depth = rel.depth, pol.names = n.poly,  name.file = paste(s.folder, 'ORO', sep = ''))

  ## ALF
  ## -  -  -  -  -  -  -  -  -  -

  rel.pol     <- c(28, 30, 31, 32, 33, 34, 25, 26, 46, 47)
  rel.depth   <- c(200, 600)
  rec.pol     <- c(rel.pol, 49, 50, 35, 36, 37, 38, 41, 42, 43, 44)
  rec.depth   <- c(0, 700)
  zones.xml(lon = lon, lat = lat, rel.pol = rel.pol, rec.pol = rec.pol,
            rel.depth = rel.depth, pol.names = n.poly, name.file = paste(s.folder, 'ALF', sep = ''))

  ## ANG
  ## -  -  -  -  -  -  -  -  -  -

  rel.pol     <- c(23, 25, 26, 35, 36, 37, 38, 41, 42, 43, 44)
  rel.depth   <- c(0, 300)
  rec.pol     <- c(rel.pol, 22, 46, 47, 33, 34, 32)
  rec.depth   <- c(0, 300)
  zones.xml(lon = lon, lat = lat, rel.pol = rel.pol, rec.pol = rec.pol,
            rel.depth = rel.depth, pol.names = n.poly, name.file = paste(s.folder, 'ANG', sep = ''))

  ## LPF
  ## -  -  -  -  -  -  -  -  -  -

  rel.pol     <- c(19, 22, 23, 25, 26, 35, 36, 37, 38, 41, 42, 43, 44)
  rel.depth   <- c(0, 300)
  rec.pol     <- c(rel.pol, 31, 32, 33, 34, 39, 40, 47, 46, 50, 49)
  rec.depth   <- c(0, 300)
  zones.xml(lon = lon, lat = lat, rel.pol = rel.pol, rec.pol = rec.pol,
            rel.depth = rel.depth, pol.names = n.poly, name.file = paste(s.folder, 'LPF', sep = ''))

#+END_SRC
****** Output connectivity matrix
#+BEGIN_SRC R :results output
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  ## ~                                  reading of the netcdf matrix anc creation of the files for atlantis                               ~ ##
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##

  source('~/Documents/PhD/Atlantis_Model/tools/Cnect.tools.R')
  library(ascii)
  options(asciiType="org")
  library(ggplot2)
  ###------------------------------------------------------##
  ### Get the connectivity matrix from the Ichtyps output  ##
  ##-------------------------------------------------------##
  global      <- '/home/demiurgo/Documents/PhD/Recruitment/Output/'
  directories <- dir(global)
  connect.l   <- list()
  for (fg in 1: length(directories)){
      ## loop thought the folder of the FGs
      direct          <- paste(global, directories[fg], '/', sep = '')
  #    debug(connect.matrix)
      connect.l[[fg]] <- connect.matrix(direct)
  }


  ## -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - ##
  ## Generating the files NC files for the connectivity   ##
  # -  -  -  -  -  -  -  -  -  -  -  -  -  - -  -  -   - - #

  create.netcdf(connect.l, directories)

  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  ## ~                  Average connectivity by year and FG               ~ ##
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  connect <- matrix(0, nrow =  length(directories), ncol = 8)
  for( fg in 1: length(directories)){
      for(sim in 1 : 8) {
          connect[fg, sim] <- mean(rowSums(connect.l[[fg]][, , sim]))
      }
  }


  rownames(connect) <- directories
  colnames(connect) <- 2000 : 2007
  cap   <- 'Mean pelagic connectivity by year and functional groups'
  b     <- ascii(connect, header = T,  include.rownames = TRUE, include.colnames = T, caption = cap)
  print(b)

  ##~ Plots
  connectivity.out  <- data.frame(Year = sort(rep(c(2000 : 2007), length(directories))),
                                  FG = rep(directories, 8), Connect = c(connect))

  png('img/connectivity.png', height = 1000, width = 1000)
  sp    <- ggplot(data=connectivity.out, aes(Year, Connect))+ geom_line()
  sp + facet_wrap(~FG, ncol = 4, scales = 'free_y')
  invisible(dev.off())

#+END_SRC
#+RESULTS:
#+CAPTION: Mean pelagic connectivity by year and functional groups
|     | 2000 | 2001 | 2002 | 2003 | 2004 | 2005 | 2006 | 2007 |
|-----+------+------+------+------+------+------+------+------|
| ALF | 0.05 | 0.08 | 0.07 | 0.09 | 0.07 | 0.07 | 0.05 | 0.02 |
| ANG | 0.04 | 0.04 | 0.06 | 0.02 | 0.04 | 0.02 | 0.01 | 0.02 |
| BRC | 0.02 | 0.02 | 0.03 | 0.03 | 0.01 | 0.00 | 0.01 | 0.02 |
| GCR | 0.04 | 0.07 | 0.07 | 0.06 | 0.06 | 0.05 | 0.07 | 0.04 |
| LBF | 0.10 | 0.04 | 0.14 | 0.19 | 0.12 | 0.09 | 0.05 | 0.11 |
| LPF | 0.09 | 0.06 | 0.12 | 0.09 | 0.07 | 0.10 | 0.09 | 0.04 |
| ORO | 0.05 | 0.04 | 0.06 | 0.05 | 0.05 | 0.03 | 0.03 | 0.02 |
| SBF | 0.08 | 0.03 | 0.11 | 0.17 | 0.08 | 0.06 | 0.05 | 0.07 |
| SPF | 0.06 | 0.01 | 0.10 | 0.18 | 0.04 | 0.01 | 0.03 | 0.03 |
| SPL | 0.02 | 0.05 | 0.08 | 0.03 | 0.05 | 0.02 | 0.02 | 0.02 |
#+end_example

#+name: fig.connect
#+ATTR_HTML: width="600" alt="image"
#+caption: Average connectivity by year and FG
[[file:img/connectivity.png]]

***** Recruitment model
****** Estimation of B-H parameter
- The Formula used is the option 3 for atlatnis
  R_{c}=(Sp * BHa)/Biomass + BHb
- Sp = ((Wsp * FSP - KSPA ) - (Wsp - W)) * Nm * FSPB
- Asumptions
  - Wsp-W = 0; the indivifual are all at optimal reproductive stage (the same wieight)
  - Wsp =  weight * 1.4; the individual use in average 40% of their weigth in reproduction
  - Nm and Biomass = The biomass calculated is based on the number of individual. I use the allometric relationship (calculated before)
  - The sorvival between one year an the other is based on the Natural mortality and the losses based on the connectivity
    - Biomas_{t+1} = Biomas(t)*exp(-M) + Rec_{t} * Survive
  - FSPB I assume that all of the individual are mature at that age.
  #+BEGIN_SRC R :results output
    ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
    ## ~                  Beverton-holtz parameter estimation               ~ ##
    ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
    library(ascii)
    options(asciiType = "org")
    source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/Atlantis_tools.R')
    ##~ Read data
    data <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/Spawning/B-H.csv')
    ##~ Weight at mat
    data$w.at.m <- with(data,  weight2N(alometric(l.mat,alf.all,beta.all), metric = 'g'))
    ##~ Weight at spawning
    data$wsp <- data$w.at.m * 1.4
    ##~ Calculating the amount of Spawn (Sp)
    data$Sp  <- with(data, (wsp * FSP - KSPA) * Nm * prop)
    data$bio <- with(data, wsp * Nm)

                                            #data$KSPA <- 1

    b.h <- function(Sp, biomass, alfa, beta, lag, Surv, M){
        Ro    <- (Sp * exp(alfa)) / (biomass + exp(beta))
        B.lag <- (Ro * Surv) * exp( - M * lag) + biomass * exp( - M * lag)
        return(B.lag)
    }


    for( i in 1 :  dim(data)[1]){
        ## Estimation of parameters
        Bio     <- data$bio[i]
        Sp      <- data$Sp[i]
        biomass <- data$biomass[i]
        Age.mat <- data$Age.mat[i]
        Survive <- data$Survive[i]
        M       <- 0.2
        ## optim
        MRSS <- function(biom, par){
            (biom -  b.h(Sp, Bio, par[1], par[2], Age.mat, Survive, M)) ^ 2
        }
        ## trying diffetente starting values
        for( t in 1 : 100){
            res <- optim(par = c(log(t), log(t)) , MRSS, biom = Bio, method = 'CG' )
            if(t == 1) res.tmp <- res
            if(res$value < res.tmp$value){
                res.tmp <- res
            }
        }
        data$Alfa.bh[i] <- exp(res.tmp$par[1])
        data$Beta.bh[i] <- exp(res.tmp$par[2])
    }

    cap   <- 'Estimation of the Beverton-holt parameters'
    b     <- ascii(data, header = T,  include.rownames = FALSE, include.colnames = T, caption = cap)
    print(b)
  #+END_SRC
  #+RESULTS:
  #+CAPTION: Estimation of the Beverton-holt parameters
  | FG  | FSP  | KSPA     | Nm      | alf.all | beta.all | Age.mat | l.mat    | Survive | prop | w.at.m         | wsp            | Sp               | bio               | Alfa.bh             | Beta.bh |
  |-----+------+----------+---------+---------+----------+---------+----------+---------+------+----------------+----------------+------------------+-------------------+---------------------+---------|
  | ALF | 0.31 | 939.02   | 1000.00 | 0.05    | 2.84     | 6.00    | 54.82    | 0.06    | 1.00 | 26221.61       | 36710.26       | 10441160.66      | 36710260.20       | 4761569555.28       | 5.00    |
  | ANG | 0.29 | 137.78   | 1000.00 | 0.00    | 2.83     | 2.00    | 131.18   | 0.03    | 0.50 | 30160.64       | 42224.89       | 6053719.07       | 42224890.16       | 4501806169.25       | 6.00    |
  | BRC | 0.31 | 364.60   | 1000.00 | 0.01    | 3.15     | 5.00    | 50.56    | 0.02    | 1.00 | 12267.89       | 17175.05       | 4959666.03       | 17175051.72       | 6017641254.46       | 93.99   |
  | GCR | 0.29 | 56.18    | 1000.00 | 0.53    | 2.84     | 6.00    | 14.75    | 0.06    | 0.50 | 7068.33        | 9895.66        | 1406780.33       | 9895657.45        | 2878490550.20       | 71.99   |
  | LBF | 0.32 | 4638.99  | 1000.00 | 0.00    | 3.88     | 12.00   | 101.51   | 0.11    | 0.20 | 101342.45      | 141879.43      | 8152485.34       | 141879427.16      | 233211625935.31     | 24.00   |
  | LPF | 0.29 | 117.17   | 1000.00 | 0.03    | 2.73     | 3.00    | 70.83    | 0.08    | 0.25 | 20670.09       | 28938.12       | 2068721.35       | 28938122.08       | 4033992076.64       | 9.00    |
  | ORO | 0.47 | 6915.95  | 1000.00 | 0.04    | 2.91     | 33.00   | 51.66    | 0.04    | 0.67 | 27180.73       | 38053.03       | 7349211.59       | 38053026.66       | 3579941264946.31    | 39.00   |
  | OTA | 0.37 | 74926.06 | 1000.00 | 3.88    | 2.07     | 5.00    | 31597.16 | 0.80    | 0.33 | 52467703339.25 | 73454784674.95 | 8968804483211.89 | 73454784674952.41 | 1292141376737862.00 | 95.00   |
  | SBF | 0.31 | 411.93   | 1000.00 | 7.08    | 1.37     | 3.00    | 60.96    | 0.08    | 1.00 | 12674.96       | 17744.94       | 5089000.57       | 17744937.33       | 629201273.76        | 29.00   |
  | SPF | 0.32 | 331.33   | 1000.00 | 0.01    | 3.14     | 3.00    | 48.30    | 0.06    | 1.00 | 8952.58        | 12533.61       | 3679425.24       | 12533610.14       | 608039026.03        | 5.00    |
  | SPL | 0.35 | 609.71   | 1000.00 | 0.96    | 2.72     | 6.00    | 12.94    | 0.03    | 0.50 | 6467.00        | 9053.79        | 1279558.82       | 9053793.27        | 4266434446.74       | 27.00   |

  -  Estimation recruitment coral
      -  These species have low growth rate and low mortality Roger et al
     #+BEGIN_SRC R :results output
       library(ascii)
       options(asciiType = "org")

       ## Initial values

       c.a    <- 8
       c.b    <- 7
       c.c    <- 20
       K      <- 10000 # minimum ammount of recruit
       # number of posible colonies
       init.B <- 10000000

       coral <- function(K, c.a, c.b, c.c, biom){
           K + c.a * max(c(0, (c.b - exp(-c.c * biom))))
       }
       ## hacer un arreglo en matrix para calcular la superficie de verosimilitud para los valores de los parametros

       biomass <- vector('numeric',100)
       biomass[1] <- init.B

       for(i in 2 : 100){
           rec          <- coral(K, c.a, c.b, c.c, biomass[i-1])
           biomass[i]   <- biomass[i - 1] * exp(-0.15) + rec
       }


     #+END_SRC

****** EStimation of weight at recruitment
#+BEGIN_SRC R :results output
  library(ascii)
  options(asciiType = "org")
  source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/Atlantis_tools.R')
  ##~ Read data
  data <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/Spawning/weight_rec.csv')

  data$weight <- with(data, ifelse(is.na(weight),
                                   alometric(size, alf.all, beta.all),
                                   weight))
  ##~ estimation of structural and reserve wight for recruitment
  data <- cbind(data, with(data, weights(FG, weight,'g'))[, 2 : 3])

  cap <- 'Structural and reserve wight for recruitment'
  b     <- ascii(data, header = T,  include.rownames = FALSE, include.colnames = T, caption = cap)
  print(b)
#+END_SRC

#+RESULTS:
#+CAPTION: Structural and reserve wight for recruitment
| FG  | weight  | size | alf.all | beta.all | Reference  | structural | reserve  |
|-----+---------+------+---------+----------+------------+------------+----------|
| ALF | 0.15    | 1.50 | 0.05    | 2.84     | Mundy1990  | 0.36       | 0.97     |
| ANG | 0.69    | 5.80 | 0.00    | 2.83     | Miller2009 | 1.65       | 4.37     |
| BRC | 0.28    | 3.04 | 0.01    | 3.15     | Bruce2001  | 0.67       | 1.77     |
| GCR | 9.61    | 2.77 | 0.53    | 2.84     | Anger1983  | 23.09      | 61.18    |
| LBF | 0.17    | 5.30 | 0.00    | 3.88     | Mujica     | 0.41       | 1.07     |
| LPF | 4.40    |      | 0.03    | 2.73     | Lopez 2000 | 10.57      | 28.01    |
| ORO | 0.01    | 0.53 | 0.04    | 2.91     | Zeldis     | 0.02       | 0.05     |
| OTA | 8600.00 |      | 3.88    | 2.07     | Osman      | 20668.11   | 54770.49 |
| SBF | 31.94   | 3.00 | 7.08    | 1.37     |            | 76.77      | 203.43   |
| SPF | 0.06    | 2.00 | 0.01    | 3.14     | Sawada     | 0.15       | 0.40     |
| SPL | 0.96    | 1.00 | 0.96    | 2.72     | Porobic    | 2.31       | 6.13     |

**** LFD by cohorts
In this secction I use the data form the Database to get the number of organism by cohort. The cohorts used here matches the cohort on Atlantis

 #+BEGIN_SRC R :results output
   rm(list = ls())
   library(ascii)
   options(asciiType = "org")
   library(ggplot2)
   source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/General_tools/Atlantis_tools.R')
   ## data
   lf    <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/cohorts/LF.csv')
   p.l   <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/cohorts/params.csv', row.names=1)
   ##~ Grupos funcionales
   lf    <- FG(lf, 2)
   lf.fg <- split(lf, lf$FG)  # split by functional group
   for(i in 1 : ncol(p.l)){
       ##~ Looking FG
       t.fg   <- which(names(lf.fg) %in% colnames(p.l)[i])
       len    <- lf.fg[[t.fg]][, 3]
       if(colnames(p.l)[i] %in% c('ANG', 'LBF', 'SBF')) len <- lf.fg[[t.fg]][, 4]
       intv   <- seq(from = p.l[5, i],  by = p.l[5, i], length = (p.l[4, i] / p.l[5, i]) - 1)
       temp.l <- vb(p.l[1, i], p.l[3, i], p.l[2, i], 1 : p.l[4, i])
       t.out  <- hist(len, breaks = c(0, temp.l[intv], max(len, na.rm = T)), plot = FALSE)
       ## reconstruction age aproximation using lineal regretion
       t.out  <- with(t.out, data.frame(Mid = mids, Count = counts))
       max.p  <- which.max(t.out[, 2])
       min.p  <- which.min(t.out[max.p : nrow(t.out), 2])
       reg.o  <- with(t.out, lm(Count ~ Mid, data = t.out[max.p : min.p, ]))
       ## Recalculating the data
       for( j in 1 : (max.p - 1)){
           t.out[j, 2] <- t.out[j, 1]  * reg.o$coef[2] + reg.o$coef[1]
       }
       ## Correction of Zeros
       t.out$Count <- ifelse(t.out$Count == 0, min(t.out$Count[t.out$Count > 0], na.rm = T), t.out$Count)
       t.out$Prop  <- t.out$Count / sum(t.out$Count, na.rm = T)
       age.c       <- c(paste('Cohort 0', 1 : 9, sep = ''),  'Cohort 10')
       t.out       <- cbind(FG = as.factor(colnames(p.l)[i]), Age_group = age.c[1 : nrow(t.out)], t.out)
       if(i == 1){
           output <- t.out
       } else {
           output <- rbind(output, t.out)
       }
   }
   ## Table
   cap     <- 'Proportion of Individual by Cohort,  based on the configuration of Atlantis'
   tab.out <- xtabs(Prop ~ FG + Age_group, output)
   png('img/Cohorts.png', height = 1000, width = 1000)
   sp    <- ggplot(data = output, aes(Age_group, Prop, group = 1))+ geom_line()
   sp + facet_wrap(~FG, ncol = 4, scales = 'free_y')
   invisible(dev.off())
   b     <- ascii(tab.out, header = T,  include.rownames = TRUE, include.colnames = TRUE, caption=cap, digits=3)
   print(b)
 #+END_SRC
 #+RESULTS:
#+CAPTION: Proportion of Individual by Cohort,  based on the configuration of Atlantis
|      |     | *Age_group* |           |           |           |           |           |           |           |           |           |
|      |     | Cohort 01   | Cohort 02 | Cohort 03 | Cohort 04 | Cohort 05 | Cohort 06 | Cohort 07 | Cohort 08 | Cohort 09 | Cohort 10 |
|------+-----+-------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------|-----------|
| *FG* | ANG | 0.576       | 0.287     | 0.113     | 0.012     | 0.001     | 0.001     | 0.001     | 0.001     | 0.001     | 0.006     |
|      | BRC | 0.436       | 0.238     | 0.168     | 0.063     | 0.032     | 0.018     | 0.011     | 0.008     | 0.005     | 0.020     |
|      | VID | 0.867       | 0.092     | 0.037     | 0.005     | 0.000     | 0.000     | 0.000     | 0.000     | 0.000     | 0.000     |
|      | LBF | 0.551       | 0.244     | 0.137     | 0.019     | 0.008     | 0.004     | 0.004     | 0.004     | 0.004     | 0.027     |
|      | SBF | 0.473       | 0.269     | 0.144     | 0.057     | 0.028     | 0.004     | 0.004     | 0.004     | 0.004     | 0.013     |
|      | LPF | 0.512       | 0.402     | 0.051     | 0.010     | 0.007     | 0.010     | 0.005     | 0.002     | 0.000     | 0.001     |
|      | SPF | 0.201       | 0.185     | 0.177     | 0.171     | 0.166     | 0.077     | 0.015     | 0.002     | 0.002     | 0.005     |
|      | ALF | 0.384       | 0.235     | 0.152     | 0.144     | 0.063     | 0.016     | 0.002     | 0.002     | 0.002     | 0.002     |
|      | ORO | 0.432       | 0.252     | 0.149     | 0.084     | 0.046     | 0.018     | 0.006     | 0.004     | 0.004     | 0.004     |

#+ATTR_HTML: width="600" alt="image"
[[/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/MandM/img/Cohorts.png]]
@<br style="clear:both;" />

**** Estimation of the mean Weight
- Based on the catch data and the data at age available I calculated the mean weight for several groups
#+BEGIN_SRC R :results output
  ## Estimation of the mean weight for the FG
  rm(list=ls())
  library(ascii)
  options(asciiType = "org")
  source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/General_tools/Atlantis_tools.R')
  datos <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/length_weight/length_weight_jf.csv')
  w.fg  <- FG(datos, 2)
  w.fg  <- split(w.fg, w.fg$FG)
  ## estimation of mean weight
  weigth <- vector('numeric')
  for( i in 1: length(w.fg)){
  weigth[i] <- mean(w.fg[[i]]$weight)
  }
  ## output
  cap <- 'Mean weight for Functional Group (FG)'
  out <- data.frame(FG = names(w.fg), Mean.Weight = weigth)
  b   <- ascii(out, header = T,  include.rownames = FALSE, include.colnames = TRUE, caption=cap)
  print(b)
#+END_SRC

#+RESULTS:
#+begin_example
#+CAPTION: Mean weight for Functional Group (FG)
| FG  | Mean.Weight |
|-----+-------------|
| ANG | 1013.75     |
| BRC | 745.93      |
| CHO | 4298.08     |
| GCR | 697.06      |
| LBF | 4125.24     |
| LPF | 484.88      |
| OCT | 640.00      |
| OTA | 75857.01    |
| SBF | 1203.85     |
| SPF | 318.45      |
| SPL | 630.62      |
| VID | 3755.67     |
#+end_example

**** Temperature
***** Recruitment
| FG  |  Max | Min | Reference                   | Specie          |
|-----+------+-----+-----------------------------+-----------------|
| SPL |   25 |   8 | Whale and Fogarty 2007      | lobsters        |
|     |      |   5 | Waddy and aiken 1995        | H. americanus   |
|     |      | 9.8 |                             | J. edwarsii     |
| GCR |   32 |   2 | Prentice and Schneider 1978 | Dungeness crab  |
|     |   19 |   4 | Hardy and Dutil 1994        | Snow crab       |
|     |      |  10 | hill 1974                   | Portunid crab   |
|     | 28.5 |  10 | Maestre et al 2015          | Chaceon affinis |
|     |      |     |                             |                 |
***** Optimal temperature
     | FG  |   Opt. temp | Value Used | Reference                  | Species                    |
     |-----+-------------+------------+----------------------------+----------------------------|
     | SPL |          17 |         17 | Dupre1985                  | Jasus frontalis            |
     |     |       16-18 |            | Dubber 2004                | Jasus lalandii             |
     |-----+-------------+------------+----------------------------+----------------------------|
     | GCR |           5 |          5 | Ahumada 2009               | Chaceon chislensis         |
     |-----+-------------+------------+----------------------------+----------------------------|
     | BRC |       16-18 |         17 | Neuheimer 2011             | Cheilodactylus spectabilis |
     |-----+-------------+------------+----------------------------+----------------------------|
     | ORO |         4-5 |          5 | Dunn 2011                  | Orange Roughy              |
     |-----+-------------+------------+----------------------------+----------------------------|
     | ANG |          17 |         17 | EOL                        | eels moray                 |
     |-----+-------------+------------+----------------------------+----------------------------|
     | ALF |       16-19 |         17 | Lehedoy 1995               | Alfonsino                  |
     |-----+-------------+------------+----------------------------+----------------------------|
     | CHO |        8-17 |         13 | Fishbase                   | Squalus mitsukurii         |
     |-----+-------------+------------+----------------------------+----------------------------|
     | OCT |       16-21 |       18.5 | Delgado 2011               | Octopus vulgaris           |
     |-----+-------------+------------+----------------------------+----------------------------|
     | SQD |       15-28 |         10 | Nigmatullin 2001           | Dosidicus gigas            |
     |     |        3-10 |            | Watanabe 2006              | Squids (vampirotheutis)    |
     |-----+-------------+------------+----------------------------+----------------------------|
     | COR |        4-13 |          9 | Guinote 2005               | Deep sea corals            |
     |     |        4-15 |            | Brooke 2013                | Lophelia pertusa           |
     |-----+-------------+------------+----------------------------+----------------------------|
     | LPF |          20 |         20 | Fishbase                   | Pseudocaranx dented        |
     |-----+-------------+------------+----------------------------+----------------------------|
     | SPF |       23-29 |            | Encyclopedia of Life (EOL) | Kyphosus cinerascens       |
     |     |          27 |      20.75 | Fishbase                   | Kyphosus cinerascens       |
     |     | 16.92-17.02 |            | EOL                        | Scartichthys variolatus    |
     |     | 14.66-17.65 |            |                            | Callanthias allporti       |
     |-----+-------------+------------+----------------------------+----------------------------|
     | SBF |       17.07 |            | EOL                        | Chironemus bicornis        |
     |     |       13.27 |     13.025 | EOL                        | Plectranthias exsul        |
     |     |  8.41-13.35 |            | EOL                        | Helicolenus lengerichi     |
     |-----+-------------+------------+----------------------------+----------------------------|
     | LBF |  5.44-25.74 |            | EOL                        | Polyprion oxygeneios       |
     |     |       15-21 |      20.22 | Khan 2015                  | Polyprion oxygeneios       |
     |     | 16.92-17.02 |            | EOL                        | Lotella fernandeziana      |
     |-----+-------------+------------+----------------------------+----------------------------|
     | SCR |  8.46-13.87 |     12.218 | EOL                        | Paromola cuvieri           |
     |     |  8.85-17.69 |            | EOL                        | Ovalipes trimaculatus      |
     |-----+-------------+------------+----------------------------+----------------------------|
     | BCA |       14.04 |            | EOL                        | Phymactis clematis         |
     |     |  8.32-20.98 |      17.37 | EOL                        | Corynactis                 |
     |     |   15.7-21.3 |            | Delorme 2013               | Evechinus chloroticus      |
     |     |       23.88 |            | EOL                        | Centrostephanus asteriscus |
     |-----+-------------+------------+----------------------------+----------------------------|
     | MOL |       14-20 |     19.752 | Rabi and Maravi 1997       | Concholepas concholepas    |
     |     | 20.69-24.32 |            | EOL                        | Thacacera                  |




****** Temperature tolerance (Griffin model)

**** Oxigen
***** Oxygen model used for epibenthic invertebrate *Quadratic limitation* (O2case = 3)
  + Calculates both ambient and depth based limitation and uses the larger of the two values as the oxygen scalar dO2
  + *Ambient oxygen limitation*: uses ambient oxygen levels O amb , lethal oxygen concentration (KO2\_XXX, mgO2m-3) and limiting oxygen concentration (KO2lim\_XXX, mgO2 m -3 ) parameters. Remember that oxygen solubility in seawater at 5C and 1bar pressure is 10 mg/l or 10000 mg m -3 .
     | FG  | KO2 (mg / m3) | KO2lim | reference    |
     |-----+---------------+--------+--------------|
     | SPL |          1320 |   2900 | Mcleese 1956 |
     | GCR |          2450 |   3210 | Vaquer2008   |
     | SCR |          2450 |   3210 |              |
     | BFF |           890 |    690 |              |
     | LPH |             0 |        |              |
     | SPH |             0 |        |              |
     | SUR |           890 |   1220 |              |
     | MOL |           890 |   1990 |              |
     | PB  |             0 |        |              |
     | BB  |             0 |        |              |



#+BEGIN_SRC R
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  ## ~                     Oxigen mortality and tolerance functions                 ~ ##
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##

  ##
  ## Oxigen functions
  ##~~~~~~~~~~~~~~~~~~~~

  lim_oxi <- function(Oxi, KO2, KO2lim){
      KO2 = 1320
      KO2lim = 2900
      Oxi = 1:8000
      oxi2 <- ifelse(Oxi >= KO2 & KO2lim >= KO2, ((Oxi - KO2)^2 / ((Oxi - KO2)^2 + (KO2lim - KO2) ^ 2)),
          ifelse(Oxi >= KO2 & KO2lim < KO2, 1, 0))
          return(oxi2)
      }


#+END_SRC

**** Extra Mortality
     I'm not including xxplicit fish mortality by season (mS_FDXXX) and seabird and mamal induced mortality (mS_SBXXX)
**** Bibliography that I need
 - [ ] Sepulveda y PequeÃ±o,  Fauna ictica del archipielago de Juan Fernandez. En P. Arana (ed). Investigaciones Marinas en el ArchipiÃ©lago de Juan FernÃ¡ndez. Esc. Ciencias del Mar, UCV, ValparaÃ­so
 - [ ] MelÃ©ndez, C.R. y C. Villalba. 1992. Nuevos registros y antecedentes para la ictiofauna del archipiÃ©lago de Juan FernÃ¡ndez, Chile. Estud. Oceanol. 11 : 3 - 29
 - [ ] TORRES D (1987) Antecedentes sobre el lobo fino de Juan FernÃ¡ndez Arctocephalus philippii y proyecciones para su estudio. In: Castilla JC (ed) Islas oceÃ¡nicas chilenas: conocimiento cientÃ­fico y necesidades de investigaciones: 287-317. Ediciones Universidad CatÃ³lica de Chile, Santiago, Chile.

**** Codes
| Code | Functional Groups    |   | Simil SETas | Other |
|------+----------------------+---+-------------+-------|
| SPL  | Spiny lobster        |   |             |       |
| GCR  | Golden Crab          |   | BMD         |       |
| BRC  | Breca                |   | FDS         | FDM   |
| VID  | Vidriola             |   | FVT         | FVO   |
| ORO  | Orange Roughy        |   | FDF         | FDD   |
| ALF  | Alfonsino            |   | FDD         | FDM   |
| ANG  | Anguila              |   | FVD         | FVD   |
| CHO  | Chondrichtyans       |   | SHB         |       |
| OTA  | Otariid              |   | PIN         |       |
| CET  | Cetaceans            |   | WHS         | WHB   |
| BIR  | Birds                |   | SB          |       |
| OCT  | Octupus              |   | CEP         |       |
| SUR  | Sea urchins          |   | BFS         | BFF   |
| MOL  | Mollusca             |   | BFS         | BFF   |
| SCR  | Small crustaceans    |   | BMD         |       |
| LPF  | Large pelagic fish   |   | FVS         | FDE   |
| SPF  | Small pelagic fish   |   | FVS         |       |
| SBF  | Small benthic fish   |   | FDS         | FDD   |
| LBF  | Large benthic fish   |   | FVD         | FDD   |
| SZO  | Small Zooplankton    |   |             |       |
| MZO  | Medium Zooplankton   |   |             |       |
| LZO  | Large Zooplankton    |   |             |       |
| BFF  | Deposit feeders      |   |             |       |
| LPH  | Large phytoplankton  |   |             |       |
| SPH  | Small phytoplankton  |   |             |       |
| NO   | Nitrate              |   |             |       |
| MA   | Macroalgae           |   |             |       |
| PB   | Pelagic Bacteria     |   |             |       |
| BB   | Sediment Bacteria    |   |             |       |
| DL   | Labile detritus      |   |             |       |
| DR   | Refractory detritrus |   |             |       |
| DC   | Carrion              |   |             |       |
|------+----------------------+---+-------------+-------|
|      |                      |   |             |       |
|      |                      |   |             |       |
**** What is needed
***** Look for the larval duration of other species
***** Pasar los valores de KSPA and FSP
***** Poner el numero de individuos desovando
**** Resume of the configuration file
|--------------------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+----+----+-----+-----+----+----+----|
| Recruitment        |     |     | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
| Ext reproduction   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
| Vertebrate rep     |     |     | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
| IsPlanktivore      |     |     | X   | X   | X   | X   | X   | X   |     |     | X   | X   | X   | X   |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
| Local recruit      | X   | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   | X   |     |     | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| bears live young   | X   | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   | X   |     |     | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| Parental care      | X   | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   | X   |     |     | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| Feed while spawn   | X   | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   | X   |     |     | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| Temp feed eff      | X   | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   | X   |     |     | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| Temp sens          | X   | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   | X   |     |     | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| Hab depend]        | X   | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   | X   |     |     | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| D_depend           | X   | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   | X   |     |     | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| seeks Channel      | X   | X   | X   | X   | X   | X   | X   | X   |     | X   | X   | X   | X   | X   |     |     | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| Migrate out        | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   |     |     | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| Pred_func          | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   |     | X   | X   |    |    |     |     |    |    |    |
| Bioturvation       |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     | X   |     |     | X   |    |    |     |     |    |    |    |
| Bioirrigation      |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     | X   | X   |     |     | X   |    |    |     |     |    |    |    |
| G. Griff Temp      | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| Q10                | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| Calc Q10           | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| Opt. Temp          | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| Q10 Corr           | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| ph sensitive       | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| ph fecund          | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| Nutri sens         | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| pred availa        | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| contract_tol       | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| ph model           | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| Inflection ph      | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| optimal ph         | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| ph correction      | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| ph constant A      | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| ph constant B      | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| correction ph sca  | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| Salinty sensivity  | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| Correction Sainity | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| PP growth          |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     | X   |     |     |    | X  |     |     |    |    |    |
| PP light           |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     | X   |     |     |    | X  |     |     |    |    |    |
| PP nutrients       |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     | X   |     |     |    | X  |     |     |    |    |    |
| Bac nut req        |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    | X   | X   |    |    |    |
| Bac param pop      |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
| Space rectric      |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     | X   |     |     |    |    |     |     |    |    |    |
| maxbiomass         |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     | X   | X   |     |     | X   |    |    |     |     |    |    |    |
| Habitat dep        | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   |    |    |    |
| Juvenil and adult  | X   | X   | X   | X   | X   |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
| refuge ad-juv      | X   | X   | X   | X   | X   |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
| Max and min deph   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   | X  | X  | X  |
| Home range radius  | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   | X  | X  | X  |
| Overlap            | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X  | X  | X   | X   | X  | X  | X  |
|                    |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
| Function           | SPL | GCR | BRC | ORO | ALF | CHO | OTA | CET | BIR | OCT | LPF | SPF | SBF | LBF | EUP | COP | SCR | BFF | PHY | SUR | MOL | NO | MA | BAC | BAS | DL | DR | DC |
| Spatial dist.      | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   |     |     |     |     |     | X   | X   |    |    |     |     |    |    |    |
| Vert. dist. inv.   | X   | X   |     |     |     |     |     |     |     | X   |     |     |     |     | X   | X   | X   |     |     | X   | X   |    |    |     |     |    |    |    |
| Vert. dist. ver.   |     |     | X   | X   | X   | X   | X   | X   |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
|                    |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
|                    |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
|                    |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
|                    |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
|                    |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |     |    |    |     |     |    |    |    |
*** Forcing files
**** Solar radiation
- I se the information irradiance from [[http://www.soda-pro.com/web-services/radiation/nasa-sse][soda]]
- The model use rewind of the data
** Initial conditions file
- To set the initial conditions I used the Shiny application and the code that create to fill the matrix of abundance and cover
- The Shiny Application to create the csv files to fill
#+BEGIN_SRC R
  rm(list=ls())
  source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/General_tools/Atlantis_tools.R')
  ## Using Shiny-R
  library(stringr)
  library(shiny)
  library(dplyr)
  library(shinyrAtlantis)
  grp.file   <- "/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/JFREGroups.csv"
  bgm.file   <- "/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/JFRE_xy.bgm"
  cum.depths <- c(0, 20, 50, 150, 250, 400, 650, 1000, 4300)
  csv.name   <- "JFRE_ini"
  ##~ Creation of the csv files
  ## i did some modification to the Shiny aplication, because of that I'm using my own code
  source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/shiny-Shane/Fork_git/shinyrAtlantis/R/initGen.R')
  make.init.csv(grp.file, bgm.file, cum.depths, csv.name)
#+END_SRC
- To complete the matrix created with shiny I used differente source of information:
  - The initial total Abundance or biomass by group
| FG  | Mean Weight |   Number |          Biomass | reference                        |
|-----+-------------+----------+------------------+----------------------------------|
| SPL |             |  1033572 |                  | MPA Model                        |
| GCR |      697.06 |          | 327777.777777778 | Canales y Arana 2009             |
| BRC |      754.93 |          |  2259.8263333333 | Ernst 2016                       |
| SPF |      318.45 |          |  6927.6643333333 | Ernst 2016                       |
| SBF |        1203 |          |   592.7413333333 | Ernst 2016                       |
| LBF |     4125.24 |          |  1296.6216666667 | Ernst 2016                       |
| LPF |        1000 |          |  1296.6216666667 | Ernst 2016                       |
| OCT |         800 |          |          1110000 | Arancibia                        |
| BCA |             |          |                  | Friedlander2016                  |
| VID |        3755 |          |    37.0463333333 | Ernst 2016                       |
| SCR |         618 |          |                  | Friedlander2016 + Ernst Database |
| MOL |             |          |                  | Friedlander2016 + Ernst Database |
| ANG |     1013.75 |          |                  | Ernst Database                   |
| ORO |             | 36800000 |                  | Niklitschek2005                  |
| ALF |             | 23222000 |                  | Wiff et al. 2013                 |
| CHO |        4620 |          |                  | Arana 2000 + YaÃ±ez               |
| OTA |       94000 |    31633 |                  | Conaf and Osman 2007             |
| CET |    29215000 |    20128 |                  | Estimation whale Watching        |
| DOL |      467500 |    40256 |                  | Estimation whale Watching        |
| BIR |         740 |    19440 |                  | Azocar 2013                      |
| BFF |             |          |                  | Calculated from Friedlander2016  |
| COR |             |          |                  | Calculated from Friedlander2016  |
| MA  |             |          |                  | Calculated from Friedlander2016  |
| SQD |             |          |          1110000 | Same Value than Octopus          |

 - The lenght or age distribution by cohort. I used the information calculated on [[LFD by cohorts][Table]]
#+BEGIN_SRC R  :results output
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  ## ~            Fill biomass and number         ~ ##
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  rm(list=ls())
  library(ascii)
  options(asciiType = "org")
  source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/General_tools/Atlantis_tools.R')
  ##~ read proportion by box
  filename <-'/home/demiurgo/Documents/PhD/Ini_conditions/PropByBox.csv'
  grp.file <- "/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/JFREGroups.csv"
  data     <- read.csv(filename)
  in.bios  <- read.csv('/home/demiurgo/Documents/PhD/Ini_conditions/In_abundance.csv')
  boxes    <- read.poly('/home/demiurgo/Documents/PhD/Polygonos/Map/Polygons_27042016.csv')$attrib
  groups   <- read.csv(grp.file)
  lfd      <- read.csv('/home/demiurgo/Documents/PhD/Ini_conditions/Age_structure.csv')
  cov.data <- read.csv('/home/demiurgo/Documents/PhD/Ini_conditions/Type.sed.csv')

  BioNum <- init.number(data    = data, in.bios = in.bios,
                        boxes   = boxes, groups = groups, lfd = lfd, cover.d=cov.data)
  #colnames(BioNum) <- paste('box', 0 : 50)
  #cap <- 'number,biomass and percentage or cover by box'
  #b   <- ascii(BioNum, header = T,  include.rownames = TRUE, include.colnames = TRUE, caption=cap, digits=3)
#+END_SRC

 -Calculatin the Structural and reserve weight for each Functional Group
 #+BEGIN_SRC R :results output
   ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
   ## ~         Estimation of Nitrogen by Ageclass      ~ ##
   ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
   library(ascii)
   library(ggplot2)
   data  <- read.csv('/home/demiurgo/Documents/PhD/Functional_groups/Nitrogen_by_Agegroup/age_length.csv')
   options(asciiType="org")
   source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/Atlantis_tools.R')
   ## estimation of the weight at each age class or cohort
   data$Weight     <- ifelse(is.na(data$Weight), alometric(data$Length, data$alfa, data$beta), data$Weight)

   w.data     <- with(data, weights(FG, Weight, 'g', wet = TRUE))
   w.data$AgeClass <- data$AgeClass
   ## Plotting
   sp            <- ggplot(data = w.data, aes(AgeClass, label = 'Weight')) +
       geom_line(aes(y = reserve, colour = 'Reserve')) +
       geom_line(aes(y = structural, colour = 'Structural')) +
       xlab("Cohort") +
       ylab("Weight (MgN)")
   png('img/rev_stru.png', height = 1200, width = 1200)
   sp + facet_wrap(~Functional_Groups, ncol=4, scales = 'free')
   invisible(dev.off())
   ## Table
   tab.out <- xtabs(cbind(reserve, structural) ~ Functional_Groups + AgeClass, w.data)
   cap1    <- 'Reserve by cohort for each functional group [mgN]'
   cap2    <- 'Structural by cohort for each functional group [mgN]'
   b       <- ascii(tab.out[, , 1], header=T,  include.rownames = TRUE, include.colnames = T, caption = cap1)
   c       <- ascii(tab.out[, , 2], header=T,  include.rownames = TRUE, include.colnames = T, caption = cap2)
   cat("#+ATTR_HTML: :style float:left;width:30%;margin:3ex\n")
   print(b)
   print(c)
 #+END_SRC

 #+RESULTS:
 #+ATTR_HTML: :style float:left;width:30%;margin:3ex
 [[/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/MandM/img/rev_stru.png]]
 #+CAPTION: Reserve by cohort for each functional group [mgN]
 |     | 1            | 2            | 3            | 4            | 5            | 6            | 7            | 8            | 9            | 10           |
 |-----+--------------+--------------+--------------+--------------+--------------+--------------+--------------+--------------+--------------+--------------|
 | ALF | 1088.62      | 3016.50      | 5683.68      | 8794.83      | 12083.87     | 15349.19     | 18459.23     | 21327.55     | 23928.66     | 26221.61     |
 | ANG | 5.14         | 476.77       | 2073.97      | 4803.25      | 8410.48      | 12585.66     | 17045.88     | 21564.06     | 25973.03     | 30159.05     |
 | BIR | 69.13        | 415.90       | 1066.08      | 1938.17      | 2931.67      | 3960.82      | 4963.61      | 5900.56      | 6750.08      | 7503.41      |
 | BRC | 681.99       | 1187.86      | 1903.52      | 2835.69      | 4071.67      | 5794.55      | 7999.09      | 10088.06     | 12271.21     | 14756.34     |
 | CET | 395155425.63 | 491609711.65 | 544190946.98 | 571307526.53 | 584935787.29 | 591701186.84 | 595039702.45 | 596682367.21 | 597489464.60 | 597885742.56 |
 | CHO | 463.86       | 2929.85      | 7534.30      | 13527.87     | 20078.00     | 26550.51     | 32550.19     | 37876.85     | 42464.82     | 46330.94     |
 | DOL | 4307.42      | 25566.65     | 64722.96     | 116326.38    | 174114.22    | 232990.31    | 289446.06    | 341384.57    | 387777.19    | 428327.01    |
 | GCR | 34.97        | 192.81       | 549.34       | 1157.33      | 2026.08      | 3072.45      | 4122.86      | 5046.51      | 6094.64      | 7068.33      |
 | LBF | 6768.28      | 10195.69     | 15630.74     | 20771.14     | 27974.29     | 41908.11     | 55595.37     | 65347.40     | 81692.38     | 101344.52    |
 | LPF | 404.38       | 5842.40      | 12058.50     | 16171.97     | 18457.96     | 19640.82     | 20233.53     | 20526.09     | 20669.46     | 20739.47     |
 | ORO | 19.04        | 2754.30      | 8782.94      | 14794.76     | 19420.34     | 22595.62     | 24646.17     | 25930.18     | 26709.13     | 27180.73     |
 | OTA | 201231.61    | 305483.96    | 393956.61    | 463082.98    | 514521.02    | 551653.23    | 577941.71    | 596317.57    | 609054.39    | 617832.86    |
 | SBF | 2378.48      | 3132.71      | 3940.00      | 5003.55      | 6092.65      | 7518.46      | 8371.08      | 10308.91     | 11475.56     | 12675.33     |
 | SPF | 16.46        | 530.71       | 1768.56      | 3321.01      | 4832.29      | 6127.44      | 7159.38      | 7945.64      | 8527.77      | 8950.70      |
 | SPL | 1348.65      | 1727.03      | 2166.40      | 2670.60      | 3337.86      | 3931.32      | 4572.95      | 5159.03      | 5790.63      | 6468.90      |
 | VID | 10104.27     | 15617.54     | 24989.94     | 0.00         | 0.00         | 0.00         | 0.00         | 0.00         | 0.00         | 0.00         |
 #+CAPTION: Structural by cohort for each functional group [mgN]
 |     | 1            | 2            | 3            | 4            | 5            | 6            | 7            | 8            | 9            | 10           |
 |-----+--------------+--------------+--------------+--------------+--------------+--------------+--------------+--------------+--------------+--------------|
 | ALF | 410.80       | 1138.30      | 2144.78      | 3318.80      | 4559.95      | 5792.15      | 6965.75      | 8048.13      | 9029.68      | 9894.95      |
 | ANG | 1.94         | 179.91       | 782.63       | 1812.55      | 3173.77      | 4749.31      | 6432.41      | 8137.38      | 9801.14      | 11380.77     |
 | BIR | 26.09        | 156.94       | 402.29       | 731.39       | 1106.29      | 1494.65      | 1873.06      | 2226.63      | 2547.20      | 2831.48      |
 | BRC | 257.35       | 448.25       | 718.31       | 1070.07      | 1536.48      | 2186.62      | 3018.53      | 3806.81      | 4630.64      | 5568.43      |
 | CET | 149115254.95 | 185513098.74 | 205355074.33 | 215587745.86 | 220730485.77 | 223283466.73 | 224543283.94 | 225163157.44 | 225467722.49 | 225617261.34 |
 | CHO | 175.04       | 1105.61      | 2843.13      | 5104.86      | 7576.61      | 10019.06     | 12283.09     | 14293.15     | 16024.46     | 17483.37     |
 | DOL | 1625.44      | 9647.79      | 24423.76     | 43896.75     | 65703.48     | 87920.87     | 109224.93    | 128824.36    | 146331.01    | 161632.83    |
 | GCR | 13.20        | 72.76        | 207.30       | 436.73       | 764.56       | 1159.42      | 1555.79      | 1904.34      | 2299.86      | 2667.29      |
 | LBF | 2554.07      | 3847.43      | 5898.39      | 7838.17      | 10556.34     | 15814.38     | 20979.38     | 24659.40     | 30827.31     | 38243.22     |
 | LPF | 152.60       | 2204.68      | 4550.38      | 6102.63      | 6965.27      | 7411.63      | 7635.29      | 7745.69      | 7799.80      | 7826.22      |
 | ORO | 7.19         | 1039.36      | 3314.32      | 5582.93      | 7328.43      | 8526.65      | 9300.44      | 9784.97      | 10078.92     | 10256.88     |
 | OTA | 75936.46     | 115276.97    | 148662.87    | 174748.30    | 194158.88    | 208171.03    | 218091.21    | 225025.50    | 229831.84    | 233144.47    |
 | SBF | 897.54       | 1182.16      | 1486.79      | 1888.13      | 2299.11      | 2837.16      | 3158.90      | 3890.16      | 4330.40      | 4783.14      |
 | SPF | 6.21         | 200.27       | 667.38       | 1253.21      | 1823.51      | 2312.24      | 2701.65      | 2998.36      | 3218.03      | 3377.62      |
 | SPL | 508.92       | 651.71       | 817.51       | 1007.77      | 1259.57      | 1483.52      | 1725.64      | 1946.81      | 2185.14      | 2441.09      |
 | VID | 3812.93      | 5893.41      | 9430.17      | 0.00         | 0.00         | 0.00         | 0.00         | 0.00         | 0.00         | 0.00         |



 - Write the csv and the nc file witht he information
#+BEGIN_SRC R

  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  ## ~                 Write the information on the CSV             ~ ##
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  ## Library and Sources
  source('/home/demiurgo/Documents/PhD/Atlantis_Model/tools/General_tools/Atlantis_tools.R')
  ## read Shiny File
  shy.file <- '/home/demiurgo/Documents/PhD/Ini_conditions/JFRE_ini_horiz.csv'
  csv.file <- read.csv(shy.file)
  ## Read the data file
  dat.file <- '/home/demiurgo/Documents/PhD/Ini_conditions/Initial.Abundance.csv'
  csv.dat  <- read.table(dat.file, sep=' ', row.names = 1)
  i = 1
  for(i in 1 : nrow(csv.dat)){
      ## modified the currrent values
      pos.csv <- which(csv.file$Variable %in% rownames(csv.dat)[i])
      csv.file[pos.csv, 2 : ncol(csv.file)] <- as.numeric(csv.dat[i, ])
  }
  write.table(csv.file, file = '/home/demiurgo/Documents/PhD/Ini_conditions/JFRE_ini_horiz.csv', row.names = FALSE)

  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  ## ~            Creation of the nc file         ~ ##
  ## ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ##
  library(shinyrAtlantis)
  library(ncdf4)
  grp.file    <- "/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/JFREGroups.csv"
  bgm.file    <- "/home/demiurgo/Documents/PhD/Atlantis_Model/model_JFR/JFRE_xy.bgm"
  JFRE.init   <- "/home/demiurgo/Documents/PhD/Ini_conditions/JFRE_ini_init.csv"
  JFRE.init.h <- "/home/demiurgo/Documents/PhD/Ini_conditions/JFRE_ini_horiz.csv"
  cum.depths  <- c(0, 20, 50, 150, 250, 400, 650, 1000, 4300)
  nc.file     <- "/home/demiurgo/Documents/PhD/Ini_conditions/JFRE.ini.nc"
  make.init.nc(bgm.file, cum.depths, JFRE.init, JFRE.init.h, nc.file)
#+END_SRC

* Dietary analysis (DNA)
** NGS
      I will use NGS for the analysis of the dietary relationship between the functional groups
*** Procedure
 - DNA-extraccion
   - Feacal extraction kit
     - PowerFecal DNA Isolation Kit code : MB-12830-50
       Price : $439.00 ex. GST. kit of 50
 - Concentration determination
   - Fluorecense at UTAS
 - Amplicon PCR
   - Tailed primers  + 10% untailed primers
     - Primers
       - Furseal
       - Lobster
       - Fish
   - Taq polymerase
   - ddH2O
 - Clean Up
 - Gel
   To check if PCR works
 - Index PCR
   - Nextera index kit
   - Kapa mix
   - ddH2O
 - Checking PCR
 - Quantify amount of DNA
   - Quantiflour kit
 - Normalize the samples
 - Pool all the samples
 - Sequence in illumina MiSeq
   - Sequencing reagents (1500 for ??)
*** Results
- DNA-extraction
| ID | Specie          | JF-ID  |   |   |
|----+-----------------+--------+---+---|
|  1 | Pulpo           | Pu_23  |   |   |
|  2 | cangrejo dorado | CD_10  |   |   |
|  3 | Lobo de mar     | Lb_28  |   |   |
|  4 | Breca           | Bre_21 |   |   |
|  5 | Vidriola        | Vi_25  |   |   |
|  6 | Vidriola        | Vi_13  |   |   |
|  7 | Chancharro      | Ch_6   |   |   |
|  8 | Jurelillo       | Jur_9  |   |   |
|  9 | Pez payaso?     | P_7    |   |   |
| 10 | Vidriola        | Vi_18  |   |   |
| 11 | Breca           | Bre_14 |   |   |
| 12 | Breca           | Bre_5  |   |   |
| 13 | Vidriola        | Vi_26  |   |   |
| 14 | Vidriola        | Vi_22  |   |   |
| 15 | Breca           | Bre_16 |   |   |
| 16 | jurel           | Ju_15  |   |   |
| 17 | Lobo de mar     | Lb_27  |   |   |
| 18 | Vidriola        | Vi_17  |   |   |
| 19 | Vidriola        | Vi_20  |   |   |
| 20 | Breca           | Bre_24 |   |   |
| 21 | Breca           | Bre_19 |   |   |

** Cost DNA procedure
-All the cost are in AUD
   | Step-materials      | Total Amount | Price unit          | Total Price (182) | Total (96) |
   |---------------------+--------------+---------------------+-------------------+------------|
   | Consumables         |          Lot | 300                 |               300 |        300 |
   | DNA-Extraccion      |           96 | 439(kit 50)         |              1756 |        878 |
   | Cons. Determination |           96 | 2 per sample        |               364 |        192 |
   | Amplicon-PCR        |           96 | 40 (96-well plate)  |                80 |         40 |
   | Gel                 |           96 |                     |                   |            |
   | Cleanup             |           96 | 8 (10 samples)      |               160 |         80 |
   | Index-PCR           |           96 | 800 (96-well plate) |              1600 |        800 |
   | Gel                 |              |                     |                   |            |
   | Clean-up            |           96 | 8 (10 samples)      |               160 |         80 |
   | Gel                 |              |                     |                   |            |
   | Sequence Ilumina    |           96 | 1500 (regents)      |              1500 |       1500 |
   |---------------------+--------------+---------------------+-------------------+------------|
   |                     |              | Total               |              5620 |       3570 |
#+TBLFM: $4=vsum(@3$4..@12$4)::$5=vsum(@3$5..@12$5)

** Functional groups
  | Functional Groups  | Current Number | Needed | Total |   |
  |--------------------+----------------+--------+-------+---|
  | Spiny_lobster      |                |     18 |  -161 |   |
  | Golden_Crab        |              1 |     17 |       |   |
  | Breca              |              8 |     10 |       |   |
  | Vidriola           |              2 |     16 |       |   |
  | Anguila            |                |     18 |       |   |
  | Otariid            |              2 |     16 |       |   |
  | Octupus            |              3 |     15 |       |   |
  | Large pelagic fish |              2 |     16 |       |   |
  | Small pelagic fish |                |     18 |       |   |
  | Small benthic fish |              1 |     17 |       |   |
  | Large benthic fish |                |     18 |       |   |
  |--------------------+----------------+--------+-------+---|
  | Per groups         |             18 |        |       |   |
#+TBLFM: $3=$VAL-$2::$4=:$VAL-vsum(@2$3..@12$3)::@2$4=$VAL-vsum(@2$3..@12$3)
#+CONSTANTS: VAL=@13$2

** Clasification and samples
    | Functional Group   | Species              | N-Samples | adviced | Needed |
    |--------------------+----------------------+-----------+---------+--------|
    | Lobster            | Lobster              |         0 |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Golden Crab        | Golden Crab          |         1 |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Breca              | Breca                |         8 |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Octopus            | Octopus              |         4 |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Small Crustacean   | Jaiva                |           |         |        |
    |                    | King crab            |           |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Anguila            | Anguila              |           |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Large Benthic Fish | Bacalao              |           |         |        |
    |                    | Tollo                |           |         |        |
    |                    | Lenguado             |           |         |        |
    |                    | Congrio              |           |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Small Benthic Fish | Colorado             |           |         |        |
    |                    | Graniento            |           |         |        |
    |                    | Cabrilla             |           |         |        |
    |                    | Chancharro           |         1 |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Large Pelagic Fish | Corvina              |         1 |         |        |
    |                    | Jurel                |         1 |         |        |
    |                    | Jurelillo            |         1 |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Small pelagic Fish | Pampanito            |           |         |        |
    |                    | Pez Mariposa         |         1 |         |        |
    |                    | Jerguilla            |           |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Pinnipedo          | Furseal              |         2 |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Vidriola           | Yellowtail amberjack |         8 |         |        |
    |--------------------+----------------------+-----------+---------+--------|
    | Total              |                      |        28 |         |        |
    #+TBLFM: $3=vsum(@2$3..@24$3)::@25$3=vsum(@2$3..@24$3)
